

                                             V. A.  C R O S S  R E F E R E N C E R  7.3
                                                 [2008 VA Standards & Conventions]
                                             UCI: EHR CPU: EHR    Mar 25, 2016@15:27:03
Routines: 10  Faux Routines: 0

ADV       ADV2      ADV3      ADV4      ADV5      ADV6      ADV7      ADV8      ADV9      ADVDOC    

--- CROSS REFERENCING ---


Compiled list of Errors and Warnings                                                                  Mar 25, 2016@15:27:03 page 1

ADV      * *  48 Lines,  2062 Bytes, Checksum: B6322395
         ;DNL;20May89 13:00;Copyright (c) 1989 PRx, Inc.
   ADV+1        S - 2nd line of routine violates the SAC.
         I $ZVER["DSM-11" BREAK 2
   ADV+5        S - Break command used.
   ADV+5        S - Non-standard $Z special variable used.
         S $ZT="ERR1" S GAVEUP=0,S=1
   ADV+6        S - Non-standard $Z special variable used.
         S $ZT="ERR^ADV",Q=208,Y=1,N=0 D YES I  I 'HINTED(3) S HINTED(3)=1,LIMIT=LIMIT+670
   ADV+9        S - Non-standard $Z special variable used.
         S $ZE="ERR1",G="" F Z=0:0 S G=$O(^ADVG(G)) Q:G=""  I $H-10>^(G) K ^(G)
   ENDGAM+2     S - Non-standard $Z special variable used.
         S $ZE="" Q
   ENDGAM+3     S - Non-standard $Z special variable used.
TIMO     S GAVEUP=1 D ENDGAM H
   TIMO         S - 'HALT' command should be invoked through 'G ^XUSCLEAN'.
ERR      I $ZE?1"<INRPT".E S $ZE="ERR^ADV",RET="TURN^ADV3" D @$P(^ADV("QUIT"),"/",3) G @RET
   ERR          S - Non-standard $Z special variable used.
   ERR          S - Non-standard $Z special variable used.
         S N=0,F(N)="^ADV(""i"",",T(N)="^ADVG(G,",X=$H D COP K D,F,IN,N,OUT,T,U,X Q
   GCOPY+1      S - Kill of a protected variable (U).
GETIN    D KBD S W1=$P(W," ",1),W2=$P(W," ",2),U1=$E($P(U," ",1),1,5),U2=$E($P(U," ",2),1,5) K U Q
   GETIN        S - Kill of a protected variable (U).
   ERR1         F - Reference to routine '^%ET'. That isn't in this UCI.

ADV2     * *  66 Lines,  3347 Bytes, Checksum: B13378575
NEWLP    I CLOSNG,LNEW,LNEW<9 S LNEW=LP,M=130 D SPK S:'PANIC CLK2=15,PANIC=1
   ADV2+1       S - 2nd line of routine violates the SAC.

ADV3     * *  59 Lines,  3083 Bytes, Checksum: B10628377
         ;PRX;24Apr89 18:52;Copyright (c) 1989 PRx, Inc.
   ADV3+1       S - 2nd line of routine violates the SAC.
         S W1=$P(W," ",1),W2=$P(W," ",2),U1=$E($P(U," ",1),1,5),U2=$E($P(U," ",2),1,5) K U Q
   GETIN+1      S - Kill of a protected variable (U).

ADV4     * *  57 Lines,  3143 Bytes, Checksum: B11794476
AVC      I OBJ="DWARF",CLOSED S M=199 D SPK G RUCKUS
   ADV4+1       S - 2nd line of routine violates the SAC.

ADV5     * *  73 Lines,  3508 Bytes, Checksum: B14133104
AV0      W:S ! W !,"I don't understand ",W1,"." S OBJ="",RET="TU1" Q
   ADV5+1       S - 2nd line of routine violates the SAC.
GETIN    D KBD S W1=$P(W," ",1),W2=$P(W," ",2),U1=$E($P(U," ",1),1,5),U2=$E($P(U," ",2),1,5) K U Q
   GETIN        S - Kill of a protected variable (U).

ADV6     * *  65 Lines,  3240 Bytes, Checksum: B12934692
AVB      I CLOSED,^ADVG(G,"ROD2","P")'<0 S O="ROD2" D HERE S @$S($T:"M=135,BONUS=25",LP=115:"M=134,BONUS=30",1:"M=133,BONUS=45"),RET
          ="SCORE^ADV8" D SPK
   ADV6+1       S - 2nd line of routine violates the SAC.

ADV7     * *  52 Lines,  2492 Bytes, Checksum: B8631956
AVH      S M=209 Q
   ADV7+1       S - 2nd line of routine violates the SAC.

ADV8     * *  60 Lines,  2803 Bytes, Checksum: B9881802
CLOSEUP  F O="GRATE","FISSU" S ^ADVG(G,O,"P")=0
   ADV8+1       S - 2nd line of routine violates the SAC.

ADV9     * *  61 Lines,  2807 Bytes, Checksum: B11397199


Compiled list of Errors and Warnings                                                                  Mar 25, 2016@15:27:03 page 2

ADV9     * *  61 Lines,  2807 Bytes, Checksum: B11397199
HINT     D @("HINT"_J) E  Q:J=5  G HI1
   ADV9+1       S - 2nd line of routine violates the SAC.

ADVDOC   * *  57 Lines,  3162 Bytes, Checksum: B32832
I        ; Adventure is the original computer game that has inspired dozens of
   ADVDOC+1     S - 2nd line of routine violates the SAC.

--- Routine Detail   --- with R/S ROUTINE LISTING ---

ADV   2062     printed  Mar 25, 2016@15:27:03                                                                              Page 3

ADV       ;ADVENTURE V1.0.  FLH ; 07 FEB 83  3:37 PM
 +1       ;DNL;20May89 13:00;Copyright (c) 1989 PRx, Inc.
 +2       ;K  S:$ZS<6 $ZS=6 S $ZE="ERR1" S GAVEUP=0,S=1
 +3        SET GAME=$PIECE(XID,"^",2)
           SET NAME=XID("USER")
 +4       ;NEW (GAME,NAME)
 +5        IF $ZVER["DSM-11"
               BREAK 2
 +6        SET $ZT="ERR1"
           SET GAVEUP=0
           SET S=1
 +7        SET Q=65
           SET Y=54
           SET N=201
           DO YES
          IF $TEST
               DO OLDNAM
              IF $TEST
                   DO GETGAM
                   IF 1
 +8       IF '$TEST
               DO NEWNAM
               DO GCOPY
               DO GETGAM
 +9        SET $ZT="ERR^ADV"
           SET Q=208
           SET Y=1
           SET N=0
           DO YES
          IF $TEST
               IF 'HINTED(3)
                   SET HINTED(3)=1
                   SET LIMIT=LIMIT+670
 +10       GOTO ^ADV2
ENDGAM     IF '(SAVED&GAVEUP)
               KILL ^ADVG(G)
 +1       IF '$TEST
               DO PUTGAM
 +2        SET $ZE="ERR1"
           SET G=""
           FOR Z=0:0
               SET G=$ORDER(^ADVG(G))
               IF G=""
                   QUIT 
               IF $HOROLOG-10>^(G)
                   KILL ^(G)
 +3        SET $ZE=""
           QUIT 
TIMO       SET GAVEUP=1
           DO ENDGAM
           HANG 
 +1       ;
ERR        IF $ZE?1"<INRPT".E
               SET $ZE="ERR^ADV"
               SET RET="TURN^ADV3"
               DO @$PIECE(^ADV("QUIT"),"/",3)
               GOTO @RET
ERR1       DO ^%ET
           QUIT 
OLDNAM     SET M=205
           DO SPK
OL1 

ADV   2062     printed  Mar 25, 2016@15:27:03                                                                              Page 4

           DO GETIN
           IF U1="?"!(U1="HELP")
               DO LIST
               GOTO OLDNAM
 +1        IF W'?1.5AN
               SET M=203
               DO SPK
               GOTO OL1
 +2        IF U1="NEW"
               QUIT 
           SET G=U1
           IF $DATA(^ADVG(G))
               SET M=207
               DO SPK
               QUIT 
 +3        SET M=206
           DO SPK
           GOTO OLDNAM
LIST       WRITE !!
           SET G=""
           FOR X=0:8
               SET G=$ORDER(^ADVG(G))
               IF G=""
                   QUIT 
               WRITE ?X,G
               IF X>70
                   WRITE !
                   SET X=0
 +1        QUIT 
NEWNAM     SET M=202
           DO SPK
NE1        DO GETIN
           SET G=U1
           SET M=$SELECT(W'?1.5AN:203,G="NEW":210,$DATA(^ADVG(G)):204,1:207)
           DO SPK
           IF M-207
               GOTO NE1
           SET ^ADVG(G)=$HOROLOG
           QUIT 
GCOPY      FOR L=1:1:140
               SET ^ADVG(G,L,"A")=0
               SET ^("O")="/"
 +1        SET N=0
           SET F(N)="^ADV(""i"","
           SET T(N)="^ADVG(G,"
           SET X=$HOROLOG
           DO COP
           KILL D,F,IN,N,OUT,T,U,X
           QUIT 
COP        SET U(N)=""
           SET IN(N)=F(N)_"U(N))"
           SET OUT(N)=T(N)_"U(N))"
CO1        SET U(N)=$ORDER(@IN(N))
           IF U(N)=""
               QUIT 
 +1        SET D=$DATA(@IN(N))
           IF D#2
               SET @OUT(N)=@IN(N)
               IF X'=$HOROLOG
                   SET X=$HOROLOG
                   WRITE "."
 +2 

ADV   2062     printed  Mar 25, 2016@15:27:03                                                                              Page 5

           IF D>9
               SET F(N+1)=F(N)_""""_U(N)_""","
               SET T(N+1)=T(N)_""""_U(N)_""","
               SET N=N+1
               DO COP
               SET N=N-1
 +3        GOTO CO1
GETGAM     SET X=""
           FOR Z=0:0
               SET X=$ORDER(^ADVG(G,"i",X))
               IF X=""
                   QUIT 
               SET @X=^(X)
 +1        QUIT 
PUTGAM     SET X=""
           FOR Z=0:0
               SET X=$ORDER(^ADVG(G,"i",X))
               IF X=""
                   QUIT 
               SET ^(X)=@X
 +1        WRITE !!,"This adventure saved with name ",G,"."
           QUIT 
GETIN      DO KBD
           SET W1=$PIECE(W," ",1)
           SET W2=$PIECE(W," ",2)
           SET U1=$EXTRACT($PIECE(U," ",1),1,5)
           SET U2=$EXTRACT($PIECE(U," ",2),1,5)
           KILL U
           QUIT 
YES        SET M=Q
           DO SPK
           DO KBD
           IF U?1"Y".1"ES"
               SET M=Y
               IF M
                   DO SPK
 +1       IF '$TEST
               IF U'?1"N".1"O"
                   WRITE "   Please answer the question."
                   GOTO YES
 +2       IF '$TEST
               SET M=N
               IF M
                   DO SPK
 +3        KILL M
           QUIT 
KBD        IF S
               WRITE !
           READ !,W:600
           IF '$TEST
               GOTO TIMO^ADV
           SET U=W
           FOR I=1:1
               IF U?.CNPU
                   QUIT 
               IF $EXTRACT(U,I)?1L
                   SET U=$EXTRACT(U,1,I-1)_$CHAR($ASCII(U,I)-32)_$EXTRACT(U,I+1,99)
 +1        KILL I
           QUIT 
SPK        IF S
               WRITE !

ADV   2062     printed  Mar 25, 2016@15:27:03                                                                              Page 6

           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1        KILL I
           QUIT 


ADV      * *  48 Lines,  2062 Bytes, Checksum: B6322395                                               Mar 25, 2016@15:27:03 page 7
              151 bytes in comments
ADV      ;ADVENTURE V1.0.  FLH ; 07 FEB 83  3:37 PM
         ;DNL;20May89 13:00;Copyright (c) 1989 PRx, Inc.
         ;K  S:$ZS<6 $ZS=6 S $ZE="ERR1" S GAVEUP=0,S=1
         S GAME=$P(XID,"^",2),NAME=XID("USER")
         ;NEW (GAME,NAME)
         I $ZVER["DSM-11" BREAK 2
         S $ZT="ERR1" S GAVEUP=0,S=1
         S Q=65,Y=54,N=201 D YES I  D OLDNAM I  D GETGAM I 1
         E  D NEWNAM,GCOPY,GETGAM
         S $ZT="ERR^ADV",Q=208,Y=1,N=0 D YES I  I 'HINTED(3) S HINTED(3)=1,LIMIT=LIMIT+670
         G ^ADV2
ENDGAM   I '(SAVED&GAVEUP) K ^ADVG(G)
         E  D PUTGAM
         S $ZE="ERR1",G="" F Z=0:0 S G=$O(^ADVG(G)) Q:G=""  I $H-10>^(G) K ^(G)
         S $ZE="" Q
TIMO     S GAVEUP=1 D ENDGAM H
         ;
ERR      I $ZE?1"<INRPT".E S $ZE="ERR^ADV",RET="TURN^ADV3" D @$P(^ADV("QUIT"),"/",3) G @RET
ERR1     D ^%ET Q
OLDNAM   S M=205 D SPK
OL1      D GETIN I U1="?"!(U1="HELP") D LIST G OLDNAM
         I W'?1.5AN S M=203 D SPK G OL1
         Q:U1="NEW"  S G=U1 I $D(^ADVG(G)) S M=207 D SPK Q
         S M=206 D SPK G OLDNAM
LIST     W !! S G="" F X=0:8 S G=$O(^ADVG(G)) Q:G=""  W ?X,G I X>70 W ! S X=0
         Q
NEWNAM   S M=202 D SPK
NE1      D GETIN S G=U1,M=$S(W'?1.5AN:203,G="NEW":210,$D(^ADVG(G)):204,1:207) D SPK G:M-207 NE1 S ^ADVG(G)=$H Q
GCOPY    F L=1:1:140 S ^ADVG(G,L,"A")=0,^("O")="/"
         S N=0,F(N)="^ADV(""i"",",T(N)="^ADVG(G,",X=$H D COP K D,F,IN,N,OUT,T,U,X Q
COP      S U(N)="",IN(N)=F(N)_"U(N))",OUT(N)=T(N)_"U(N))"
CO1      S U(N)=$O(@IN(N)) I U(N)="" Q
         S D=$D(@IN(N)) I D#2 S @OUT(N)=@IN(N) I X'=$H S X=$H W "."
         I D>9 S F(N+1)=F(N)_""""_U(N)_""",",T(N+1)=T(N)_""""_U(N)_""",",N=N+1 D COP S N=N-1
         G CO1
GETGAM   S X="" F Z=0:0 S X=$O(^ADVG(G,"i",X)) Q:X=""  S @X=^(X)
         Q
PUTGAM   S X="" F Z=0:0 S X=$O(^ADVG(G,"i",X)) Q:X=""  S ^(X)=@X
         W !!,"This adventure saved with name ",G,"." Q
GETIN    D KBD S W1=$P(W," ",1),W2=$P(W," ",2),U1=$E($P(U," ",1),1,5),U2=$E($P(U," ",2),1,5) K U Q
YES      S M=Q D SPK,KBD I U?1"Y".1"ES" S M=Y D:M SPK
         E  I U'?1"N".1"O" W "   Please answer the question." G YES
         E  S M=N D:M SPK
         K M Q
KBD      W:S ! R !,W:600 G:'$T TIMO^ADV S U=W F I=1:1 Q:U?.CNPU  I $E(U,I)?1L S U=$E(U,1,I-1)_$C($A(U,I)-32)_$E(U,I+1,99)
         K I Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
*****   ERRORS & WARNINGS IN ADV   *****
   ADV+1        S - 2nd line of routine violates the SAC.
   ADV+5        S - Break command used.
   ADV+5        S - Non-standard $Z special variable used.
   ADV+6        S - Non-standard $Z special variable used.
   ADV+9        S - Non-standard $Z special variable used.
   ENDGAM+2     S - Non-standard $Z special variable used.
   ENDGAM+3     S - Non-standard $Z special variable used.
   TIMO         S - 'HALT' command should be invoked through 'G ^XUSCLEAN'.
   ERR          S - Non-standard $Z special variable used.


ADV      * *  48 Lines,  2062 Bytes, Checksum: B6322395                                               Mar 25, 2016@15:27:03 page 8

*****   ERRORS & WARNINGS IN ADV   *****
   ERR          S - Non-standard $Z special variable used.
   GCOPY+1      S - Kill of a protected variable (U).
   GETIN        S - Kill of a protected variable (U).
   ERR1         F - Reference to routine '^%ET'. That isn't in this UCI.

*****   INDEX OF ADV   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
   D            GCOPY+1!,CO1+1*,CO1+2
   F            GCOPY+1!
   F(           GCOPY+1*,COP,CO1+2*
>> G            ENDGAM,ENDGAM+2*,OL1+2*,LIST*,NE1*,GCOPY,GETGAM,PUTGAM,PUTGAM+1
>> GAME         ADV+3*
>> GAVEUP       ADV+6*,ENDGAM,TIMO*
>> HINTED(3     ADV+9*
   I            KBD*,KBD+1!,SPK*,SPK+1!
   IN           GCOPY+1!
   IN(          COP*,CO1,CO1+1
>> L            GCOPY*
>> LIMIT        ADV+9*
   M            OLDNAM*,OL1+1*,OL1+2*,OL1+3*,NEWNAM*,NE1*,YES*,YES+2*,YES+3!,SPK
   N            ADV+7*,ADV+9*,GCOPY+1*!,COP,CO1,CO1+1,CO1+2*,YES+2
>> NAME         ADV+3*
   OUT          GCOPY+1!
   OUT(         COP*,CO1+1
>> Q            ADV+7*,ADV+9*,YES
>> RET          ERR*
>> S            ADV+6*,KBD,SPK
>> SAVED        ENDGAM
   T            GCOPY+1!
   T(           GCOPY+1*,COP,CO1+2*
   U            GCOPY+1!,GETIN!,YES,YES+1,KBD*
   U(           COP*,CO1*,CO1+2
>> U1           OL1,OL1+2,NE1,GETIN*
>> U2           GETIN*
>> W            OL1+1,NE1,GETIN,KBD*
>> W1           GETIN*
>> W2           GETIN*
   X            LIST*,GCOPY+1*!,CO1+1*,GETGAM*,PUTGAM*
>> XID          ADV+3
>> XID("USER"   ADV+3
>> Y            ADV+7*,ADV+9*,YES
>> Z            ENDGAM+2*,GETGAM*,PUTGAM*

Global Variables  ( * Changed  ! Killed)
   ^ADV("QUIT"         ERR
   ^ADV("t"            SPK
   ^ADVG(              ENDGAM!,ENDGAM+2,OL1+2,LIST,NE1*,GCOPY*,GETGAM,PUTGAM

Naked Globals
   ^(           ENDGAM+2!,GETGAM,PUTGAM*,SPK
   ^("O"        GCOPY*

Marked Items
   NONE


*****   INDEX OF ADV   *****                                                                          Mar 25, 2016@15:27:03 page 9

Label References
   @(           ERR
   CO1          CO1+3
   COP          GCOPY+1,CO1+2
   ENDGAM       TIMO
   GCOPY        ADV+8
   GETGAM       ADV+7,ADV+8
   GETIN        OL1,NE1
   KBD          GETIN,YES
   LIST         OL1
   NE1          NE1
   NEWNAM       ADV+8
   OL1          OL1+1
   OLDNAM       ADV+7,OL1,OL1+3
   PUTGAM       ENDGAM+1
   SPK          OLDNAM,OL1+1,OL1+2,OL1+3,NEWNAM,NE1,YES,YES+2
   YES          ADV+7,ADV+9,YES+1

External References
   ^%ET                ERR1
   TIMO^ADV            KBD
   ^ADV2               ADV+10

*****   END   *****

ADV2   3347     printed  Mar 25, 2016@15:27:03                                                                             Page 10

ADV2      ;ADVENTURE.  FLH ; 07 FEB 83  12:39 PM
NEWLP      IF CLOSNG
               IF LNEW
                   IF LNEW<9
                       SET LNEW=LP
                       SET M=130
                       DO SPK
                       IF 'PANIC
                           SET CLK2=15
                           SET PANIC=1
 +1        SET CONDLP=^ADV(LP,"c")
           IF LNEW-LP
               IF $EXTRACT(CONDLP,1,2)="00"
                   FOR DW=1:1:5
                       IF DSEEN(DW)
                           IF LD1(DW)=LNEW
                               SET LNEW=LP
                               SET M=2
                               DO SPK
                               QUIT 
 +2        SET LP=LNEW
           IF LP
               SET CONDLP=^ADV(LP,"c")
               IF $EXTRACT(CONDLP,1,2)="00"
                   DO @$SELECT(DFLAG=0:"DW1",DFLAG=1:"DW2",1:"DW3")
SHOW       IF 'LP
               GOTO DEAD^ADV8
 +1        SET DARK=0
           SET L=^ADVG(G,"LAMP","L")
           IF L'<0!'LIT
               IF L-LP!'LIT
                   IF '$EXTRACT(CONDLP,3)
                       SET DARK=1
 +2        DO SHOWL
           IF 'LP
               GOTO DEAD^ADV8
           IF $EXTRACT(CONDLP)
               SET WD1="FORCED"
               SET WD1X=^ADV(WD1)
               GOTO TRAVEL^ADV3
 +3        IF LP=33
               IF 'CLOSNG
                   IF $RANDOM(10000)<2500
                       SET M=8
                       DO SPK
 +4        IF 'DARK
               SET X=^ADVG(G,LP,"O")
               FOR J=2:1:$LENGTH(X,"/")-1
                   SET O=$PIECE(X,"/",J)
                   DO SHOWO
 +5        SET M=0
           GOTO TURN^ADV3
DW1        IF LP>14
               SET DFLAG=1
           QUIT 
DW2        IF LP>14
               IF $RANDOM(10000)<500
                   DO DW2A
                   DO DW2B
                   SET DFLAG=2
                   SET M=3

ADV2   3347     printed  Mar 25, 2016@15:27:03                                                                             Page 11

                   SET O="AXE"
                   SET L=LP
                   DO SPK
                   DO DROP
 +1        QUIT 
DW2A       FOR I=1,2
               IF $RANDOM(10000)<5000
                   SET LD($RANDOM(10000)\2000+1)=0
 +1        QUIT 
DW2B       FOR DW=1:1:5
               IF LD(DW)=LP
                   SET LD(DW)=18
                   QUIT 
 +1        QUIT 
DW3        SET (ND,ATTACK,STICK)=0
           SET K="d"
           FOR DW=1:1:5
               IF LD(DW)
                   DO DMOV
                   IF DSEEN(DW)
                       DO DWARF
 +1        IF LD(6)
               SET K="p"
               SET DW=6
               DO DMOV
               IF DSEEN(DW)
                   DO PIRAT
 +2        IF 'ND
               QUIT 
           IF ND>1
               IF S
                   WRITE !
               WRITE !,"There are ",ND," threatening little dwarves in the room with you."
 +3       IF '$TEST
               SET M=4
               DO SPK
 +4        IF 'ATTACK
               QUIT 
           IF DFLAG=2
               SET DFLAG=3
           IF ATTACK>1
               IF S
                   WRITE !
               WRITE !,ATTACK," of them throw knives at you!"
               SET M=6
 +5       IF '$TEST
               SET M=5
               DO SPK
               SET M=52
 +6        IF STICK>1
               IF S
                   WRITE !
               WRITE !,STICK," of them get you!!"
 +7       IF '$TEST
               SET M=M+STICK
               DO SPK
               IF 'STICK
                   QUIT 
 +8        SET LP2=LP
           SET LP=0
           QUIT 
DMOV 

ADV2   3347     printed  Mar 25, 2016@15:27:03                                                                             Page 12

           SET Y=^ADV(LD(DW),K)
           SET N=0
           FOR I=2:1:Y+1
               SET L=$PIECE(Y,"/",I)
               IF L-LD1(DW)
                   SET LL(N)=L
                   SET N=N+1
 +1        SET L=$SELECT(N:LL($RANDOM(10000)*N\10000),1:LD1(DW))
           SET LD1(DW)=LD(DW)
           SET LD(DW)=L
           KILL I,L,LL,N,Y
 +2        SET DSEEN(DW)=DSEEN(DW)&(LP>14)!(LD(DW)=LP)!(LD1(DW)=LP)
           IF DSEEN(DW)
               SET LD(DW)=LP
           QUIT 
DWARF      SET ND=ND+1
           IF LD(DW)=LD1(DW)
               SET ATTACK=ATTACK+1
               IF KNFL'<0
                   SET KNFL=LP
               IF $RANDOM(10000)<(DFLAG-2*950)
                   SET STICK=STICK+1
 +1        QUIT 
PIRAT      IF LP=114!(^ADVG(G,"CHEST","P")'<0)
               QUIT 
           SET F=0
 +1        FOR J=2:1:16
               SET O=$PIECE(TR,"/",J)
               DO PI1
              IF '$TEST
                   SET L=^ADVG(G,O,"L")
                   IF L<0
                       GOTO STEAL
                   IF L=LP
                       SET F=1
 +2        IF TALLY2+1=TALLY
               IF 'F
                   IF ^ADVG(G,"CHEST","L")=0
                       SET L=^ADVG(G,"LAMP","L")
                       IF L<0!(L=LP)
                           IF LIT
                               GOTO ST2
 +3        IF LD(6)-LD1(6)
               IF $RANDOM(10000)<2000
                   SET M=127
                   DO SPK
 +4        QUIT 
PI1        IF O="PLATI"
               IF LP=100!(LP=101)
 +1        QUIT 
STEAL      SET M=128
           DO SPK
           IF ^ADVG(G,"MESSA","L")=0
               SET O="CHEST"
               SET L=114
               DO MOVE
 +1        SET O="MESSA"
           SET L=140
           DO MOVE
 +2        FOR J=2:1:16
               SET O=$PIECE(TR,"/",J)

ADV2   3347     printed  Mar 25, 2016@15:27:03                                                                             Page 13

               DO PI1
              IF '$TEST
                   SET L=LP
                   IF L=^ADVG(G,O,"L")&'^("F")
                       DO CARRY
                   IF TOTING[("/"_O_"/")
                       SET L=114
                       DO DROP
 +3        GOTO ST3
ST2        SET M=186
           DO SPK
           SET O="CHEST"
           SET L=114
           DO MOVE
           SET O="MESSA"
           SET L=140
           DO MOVE
ST3        SET (LD(6),LD1(6))=114
           SET DSEEN(6)=0
           QUIT 
SHOWL      IF DARK
               IF '$EXTRACT(CONDLP)
                   IF WZDARK
                       IF $RANDOM(10000)<3500
                           SET M=23
                           SET LP2=LP
                           SET LP=0
                           DO SPK
                           QUIT 
 +1        IF TOTING["/BEAR/"
               SET M=141
               DO SPK
 +2        IF DARK
               SET M=16
               DO SPK
               QUIT 
 +3        SET J=^ADVG(G,LP,"A")
           SET ^("A")=J+1#ABB
           SET X=^ADV(LP,0)
           IF J
               IF X["/"
                   IF S
                       WRITE !
                   WRITE !,$PIECE(X,"/",2)
                   QUIT 
 +4        IF X
               IF S
                   WRITE !
               FOR I=1:1:X
                   WRITE !,^(I)
 +5        QUIT 
SHOWO      IF O="STEPS"
               IF TOTING["/GOLD/"
                   QUIT 
 +1        SET P=^ADVG(G,O,"P")
           IF P<0
               IF CLOSED
                   QUIT 
               SET (^("P"),P)=O="RUG"!(O="CHAIN")
               SET TALLY=TALLY-1
               IF TALLY

ADV2   3347     printed  Mar 25, 2016@15:27:03                                                                             Page 14

                   IF TALLY=TALLY2
                       IF LIMIT>35
                           SET LIMIT=35
 +2        IF O="STEPS"
               IF LP=^ADVG(G,O,"F")
                   SET P=1
 +3        DO PSPK
           QUIT 
SPK        IF S
               WRITE !
           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1        KILL I
           QUIT 
PSPK       SET N=^ADV(O,P,0)
           IF N
               IF S
                   WRITE !
               FOR I=.1:.1:N
                   WRITE !,^(I)
 +1        KILL I,N
           QUIT 
DROP       FOR Z=2:1:HOLDNG+1
               IF $PIECE(TOTING,"/",Z)=O
                   SET TOTING=$PIECE(TOTING,"/",1,Z-1)_"/"_$PIECE(TOTING,"/",Z+1,99)
                   SET HOLDNG=HOLDNG-1
                   QUIT 
 +1        SET ^ADVG(G,O,"L")=L
DR1        IF L>0
               SET ^("O")="/"_O_^ADVG(G,L,"O")
 +1        QUIT 
CARRY      IF TOTING[("/"_O_"/")
               QUIT 
           SET ^ADVG(G,O,"L")=-1
           SET HOLDNG=HOLDNG+1
           SET TOTING="/"_O_TOTING
CARRYF     SET Y=^ADVG(G,L,"O")
           FOR Z=2:1:$LENGTH(Y,"/")-1
               IF $PIECE(Y,"/",Z)=O
                   SET ^("O")=$PIECE(Y,"/",1,Z-1)_"/"_$PIECE(Y,"/",Z+1,99)
                   QUIT 
 +1        KILL Y,Z
           QUIT 
MOVE       SET MOL=L
           SET L=^ADVG(G,O,"L")
           IF L>0
               DO CARRY
           SET L=MOL
           DO DROP
           QUIT 


ADV2     * *  66 Lines,  3347 Bytes, Checksum: B13378575                                              Mar 25, 2016@15:27:03 page 15
              38 bytes in comments
ADV2     ;ADVENTURE.  FLH ; 07 FEB 83  12:39 PM
NEWLP    I CLOSNG,LNEW,LNEW<9 S LNEW=LP,M=130 D SPK S:'PANIC CLK2=15,PANIC=1
         S CONDLP=^ADV(LP,"c") I LNEW-LP,$E(CONDLP,1,2)="00" F DW=1:1:5 I DSEEN(DW),LD1(DW)=LNEW S LNEW=LP,M=2 D SPK Q
         S LP=LNEW I LP S CONDLP=^ADV(LP,"c") I $E(CONDLP,1,2)="00" D @$S(DFLAG=0:"DW1",DFLAG=1:"DW2",1:"DW3")
SHOW     G:'LP DEAD^ADV8
         S DARK=0,L=^ADVG(G,"LAMP","L") I L'<0!'LIT,L-LP!'LIT,'$E(CONDLP,3) S DARK=1
         D SHOWL G:'LP DEAD^ADV8 I $E(CONDLP) S WD1="FORCED",WD1X=^ADV(WD1) G TRAVEL^ADV3
         I LP=33,'CLOSNG,$R(10000)<2500 S M=8 D SPK
         I 'DARK S X=^ADVG(G,LP,"O") F J=2:1:$L(X,"/")-1 S O=$P(X,"/",J) D SHOWO
         S M=0 G TURN^ADV3
DW1      S:LP>14 DFLAG=1 Q
DW2      I LP>14,$R(10000)<500 D DW2A,DW2B S DFLAG=2,M=3,O="AXE",L=LP D SPK,DROP
         Q
DW2A     F I=1,2 I $R(10000)<5000 S LD($R(10000)\2000+1)=0
         Q
DW2B     F DW=1:1:5 I LD(DW)=LP S LD(DW)=18 Q
         Q
DW3      S (ND,ATTACK,STICK)=0,K="d" F DW=1:1:5 I LD(DW) D DMOV,DWARF:DSEEN(DW)
         I LD(6) S K="p",DW=6 D DMOV,PIRAT:DSEEN(DW)
         Q:'ND  I ND>1 W:S ! W !,"There are ",ND," threatening little dwarves in the room with you."
         E  S M=4 D SPK
         Q:'ATTACK  S:DFLAG=2 DFLAG=3 I ATTACK>1 W:S ! W !,ATTACK," of them throw knives at you!" S M=6
         E  S M=5 D SPK S M=52
         I STICK>1 W:S ! W !,STICK," of them get you!!"
         E  S M=M+STICK D SPK Q:'STICK
         S LP2=LP,LP=0 Q
DMOV     S Y=^ADV(LD(DW),K),N=0 F I=2:1:Y+1 S L=$P(Y,"/",I) I L-LD1(DW) S LL(N)=L,N=N+1
         S L=$S(N:LL($R(10000)*N\10000),1:LD1(DW)),LD1(DW)=LD(DW),LD(DW)=L K I,L,LL,N,Y
         S DSEEN(DW)=DSEEN(DW)&(LP>14)!(LD(DW)=LP)!(LD1(DW)=LP) S:DSEEN(DW) LD(DW)=LP Q
DWARF    S ND=ND+1 I LD(DW)=LD1(DW) S ATTACK=ATTACK+1 S:KNFL'<0 KNFL=LP S:$R(10000)<(DFLAG-2*950) STICK=STICK+1
         Q
PIRAT    Q:LP=114!(^ADVG(G,"CHEST","P")'<0)  S F=0
         F J=2:1:16 S O=$P(TR,"/",J) D PI1 E  S L=^ADVG(G,O,"L") G:L<0 STEAL S:L=LP F=1
         I TALLY2+1=TALLY,'F,^ADVG(G,"CHEST","L")=0 S L=^ADVG(G,"LAMP","L") I L<0!(L=LP),LIT G ST2
         I LD(6)-LD1(6),$R(10000)<2000 S M=127 D SPK
         Q
PI1      I O="PLATI",LP=100!(LP=101)
         Q
STEAL    S M=128 D SPK I ^ADVG(G,"MESSA","L")=0 S O="CHEST",L=114 D MOVE
         S O="MESSA",L=140 D MOVE
         F J=2:1:16 S O=$P(TR,"/",J) D PI1 E  S L=LP D:L=^ADVG(G,O,"L")&'^("F") CARRY I TOTING[("/"_O_"/") S L=114 D DROP
         G ST3
ST2      S M=186 D SPK S O="CHEST",L=114 D MOVE S O="MESSA",L=140 D MOVE
ST3      S (LD(6),LD1(6))=114,DSEEN(6)=0 Q
SHOWL    I DARK,'$E(CONDLP),WZDARK,$R(10000)<3500 S M=23,LP2=LP,LP=0 D SPK Q
         I TOTING["/BEAR/" S M=141 D SPK
         I DARK S M=16 D SPK Q
         S J=^ADVG(G,LP,"A"),^("A")=J+1#ABB,X=^ADV(LP,0) I J,X["/" W:S ! W !,$P(X,"/",2) Q
         I X W:S ! F I=1:1:X W !,^(I)
         Q
SHOWO    I O="STEPS",TOTING["/GOLD/" Q
         S P=^ADVG(G,O,"P") I P<0 Q:CLOSED  S (^("P"),P)=O="RUG"!(O="CHAIN"),TALLY=TALLY-1 I TALLY,TALLY=TALLY2,LIMIT>35 S LIMIT=35
         I O="STEPS",LP=^ADVG(G,O,"F") S P=1
         D PSPK Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
PSPK     S N=^ADV(O,P,0) I N W:S ! F I=.1:.1:N W !,^(I)
         K I,N Q


ADV2     * *  66 Lines,  3347 Bytes, Checksum: B13378575                                              Mar 25, 2016@15:27:03 page 16
DROP     F Z=2:1:HOLDNG+1 I $P(TOTING,"/",Z)=O S TOTING=$P(TOTING,"/",1,Z-1)_"/"_$P(TOTING,"/",Z+1,99),HOLDNG=HOLDNG-1 Q
         S ^ADVG(G,O,"L")=L
DR1      I L>0 S ^("O")="/"_O_^ADVG(G,L,"O")
         Q
CARRY    Q:TOTING[("/"_O_"/")  S ^ADVG(G,O,"L")=-1,HOLDNG=HOLDNG+1,TOTING="/"_O_TOTING
CARRYF   S Y=^ADVG(G,L,"O") F Z=2:1:$L(Y,"/")-1 I $P(Y,"/",Z)=O S ^("O")=$P(Y,"/",1,Z-1)_"/"_$P(Y,"/",Z+1,99) Q
         K Y,Z Q
MOVE     S MOL=L,L=^ADVG(G,O,"L") D:L>0 CARRY S L=MOL D DROP Q
*****   ERRORS & WARNINGS IN ADV2   *****
   ADV2+1       S - 2nd line of routine violates the SAC.

*****   INDEX OF ADV2   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> ABB          SHOWL+3
>> ATTACK       DW3*,DW3+4,DWARF*
>> CLK2         NEWLP*
>> CLOSED       SHOWO+1
>> CLOSNG       NEWLP,SHOW+3
>> CONDLP       NEWLP+1*,NEWLP+2*,SHOW+1,SHOW+2,SHOWL
>> DARK         SHOW+1*,SHOW+4,SHOWL,SHOWL+2
>> DFLAG        NEWLP+2,DW1*,DW2*,DW3+4*,DWARF
>> DSEEN(       NEWLP+1,DW3,DW3+1,DMOV+2*
>> DSEEN(6      ST3*
>> DW           NEWLP+1*,DW2B*,DW3*,DW3+1*,DMOV,DMOV+1,DMOV+2,DWARF
>> F            PIRAT*,PIRAT+1*,PIRAT+2
>> G            SHOW+1,SHOW+4,PIRAT,PIRAT+1,PIRAT+2,STEAL,STEAL+2,SHOWL+3,SHOWO+1,SHOWO+2,DROP+1,DR1,CARRY,CARRYF,MOVE
>> HOLDNG       DROP*,CARRY*
   I            DW2A*,DMOV*,DMOV+1!,SHOWL+4*,SPK*,SPK+1!,PSPK*,PSPK+1!
>> J            SHOW+4*,PIRAT+1*,STEAL+2*,SHOWL+3*
>> K            DW3*,DW3+1*,DMOV
>> KNFL         DWARF*
   L            SHOW+1*,DW2*,DMOV*,DMOV+1*!,PIRAT+1*,PIRAT+2*,STEAL*,STEAL+1*,STEAL+2*,ST2*,DROP+1,DR1,CARRYF,MOVE*
>> LD(          DW2A*,DW2B*,DW3,DMOV,DMOV+1*,DMOV+2*,DWARF
>> LD(6         DW3+1,PIRAT+3,ST3*
>> LD1(         NEWLP+1,DMOV,DMOV+1*,DMOV+2,DWARF
>> LD1(6        PIRAT+3,ST3*
>> LIMIT        SHOWO+1*
>> LIT          SHOW+1,PIRAT+2
   LL           DMOV+1!
   LL(          DMOV*,DMOV+1
>> LNEW         NEWLP*,NEWLP+1*,NEWLP+2
>> LP           NEWLP,NEWLP+1,NEWLP+2*,SHOW,SHOW+1,SHOW+2,SHOW+3,SHOW+4,DW1,DW2,DW2B,DW3+8*,DMOV+2,DWARF,PIRAT,PIRAT+1,PIRAT+2,PI1
                STEAL+2,SHOWL*,SHOWL+3,SHOWO+2
>> LP2          DW3+8*,SHOWL*
>> M            NEWLP*,NEWLP+1*,SHOW+3*,SHOW+5*,DW2*,DW3+3*,DW3+4*,DW3+5*,DW3+7*,PIRAT+3*,STEAL*,ST2*,SHOWL*,SHOWL+1*,SHOWL+2*,SPK
>> MOL          MOVE*
   N            DMOV*,DMOV+1!,PSPK*,PSPK+1!
>> ND           DW3*,DW3+2,DWARF*
>> O            SHOW+4*,DW2*,PIRAT+1*,PI1,STEAL*,STEAL+1*,STEAL+2*,ST2*,SHOWO,SHOWO+1,SHOWO+2,PSPK,DROP,DROP+1,DR1,CARRY,CARRYF
                MOVE
>> P            SHOWO+1*,SHOWO+2*,PSPK
>> PANIC        NEWLP*
>> S            DW3+2,DW3+4,DW3+6,SHOWL+3,SHOWL+4,SPK,PSPK
>> STICK        DW3*,DW3+6,DW3+7,DWARF*
>> TALLY        PIRAT+2,SHOWO+1*
>> TALLY2       PIRAT+2,SHOWO+1


*****   INDEX OF ADV2   *****                                                                         Mar 25, 2016@15:27:03 page 17

Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> TOTING       STEAL+2,SHOWL+1,SHOWO,DROP*,CARRY*
>> TR           PIRAT+1,STEAL+2
>> WD1          SHOW+2*
>> WD1X         SHOW+2*
>> WZDARK       SHOWL
>> X            SHOW+4*,SHOWL+3*,SHOWL+4
   Y            DMOV*,DMOV+1!,CARRYF*,CARRYF+1!
   Z            DROP*,CARRYF*,CARRYF+1!

Global Variables  ( * Changed  ! Killed)
   ^ADV(               NEWLP+1,NEWLP+2,SHOW+2,DMOV,SHOWL+3,PSPK
   ^ADV("t"            SPK
   ^ADVG(              SHOW+1,SHOW+4,PIRAT,PIRAT+1,PIRAT+2,STEAL,STEAL+2,SHOWL+3,SHOWO+1,SHOWO+2,DROP+1*,DR1,CARRY*,CARRYF,MOVE

Naked Globals
   ^(           SHOWL+4,SPK,PSPK
   ^("A"        SHOWL+3*
   ^("F"        STEAL+2
   ^("O"        DR1*,CARRYF*
   ^("P"        SHOWO+1*

Marked Items
   NONE

Label References
   @(           NEWLP+2
   CARRY        STEAL+2,MOVE
   DMOV         DW3,DW3+1
   DROP         DW2,STEAL+2,MOVE
   DW2A         DW2
   DW2B         DW2
   DWARF        DW3
   MOVE         STEAL,STEAL+1,ST2
   PI1          PIRAT+1,STEAL+2
   PIRAT        DW3+1
   PSPK         SHOWO+3
   SHOWL        SHOW+2
   SHOWO        SHOW+4
   SPK          NEWLP,NEWLP+1,SHOW+3,DW2,DW3+3,DW3+5,DW3+7,PIRAT+3,STEAL,ST2,SHOWL,SHOWL+1,SHOWL+2
   ST2          PIRAT+2
   ST3          STEAL+3
   STEAL        PIRAT+1

External References
   TRAVEL^ADV3         SHOW+2
   TURN^ADV3           SHOW+5
   DEAD^ADV8           SHOW,SHOW+2

*****   END   *****

ADV3   3083     printed  Mar 25, 2016@15:27:03                                                                             Page 18

ADV3      ;ADVENTURE.  FLH ; 27 JAN 83  12:32 PM
 +1       ;PRX;24Apr89 18:52;Copyright (c) 1989 PRx, Inc.
TURN       SET (VERB,OBJ)=""
           IF M
               DO SPK
TU1        FOR J=4:1:9
               IF 'HINTED(J)
                   SET HINTLC(J)=$SELECT($EXTRACT(CONDLP,5)=J:HINTLC(J)+1,1:0)
                   IF HINTLC(J)'<HINTH(J)
                       DO HINT^ADV9
 +1        IF CLOSED
               IF TOTING["/OYSTE/"
                   SET O="OYSTE"
                   SET P=1
                   IF ^ADVG(G,O,"P")<0
                       DO PSPK
 +2        IF CLOSED
               FOR J=2:1:HOLDNG+1
                   SET O=$PIECE(TOTING,"/",J)
                   SET P=^ADVG(G,O,"P")
                   IF P<0
                       SET ^("P")=-P-1
 +3        SET WZDARK=DARK
           IF KNFL>0
               IF KNFL-LP
                   SET KNFL=0
 +4        DO GETIN
TU3        SET FOOBAR=$SELECT(FOOBAR>0:-FOOBAR,1:0)
           SET TURNS=TURNS+1
           SET WD1=U1
           SET WD2=U2
           SET (WD1X,WD2X)=""
G1         IF WD1?1.U.E
               IF $DATA(^ADV(WD1))
                   SET WD1X=^(WD1)
                   IF WD1X?1"0".E
                       SET WD1=$EXTRACT(WD1X,2,99)
                       GOTO G1
G2         IF WD2?1.U.E
               IF $DATA(^ADV(WD2))
                   SET WD2X=^(WD2)
                   IF WD2X?1"0".E
                       SET WD2=$EXTRACT(WD2X,2,99)
                       GOTO G2
 +1        IF TALLY=0
               IF LP>14
                   IF LP-33
                       SET CLK1=CLK1-1
                       IF CLK1=0
                           DO CLOSEUP^ADV8
                           GOTO WD1
 +2        IF CLK1<0
               SET CLK2=CLK2-1
               IF CLK2=0
                   DO CLOSED^ADV8
                   GOTO NEWLP^ADV2
 +3        SET LIMIT=LIMIT-LIT
           IF LIMIT<31
               DO LAMP^ADV8
               IF GAVEUP
                   GOTO SCORE^ADV8
WD1 

ADV3   3083     printed  Mar 25, 2016@15:27:03                                                                             Page 19

           IF WD1="ENTER"
               IF WD2="WATER"!(WD2="STREA")
                   SET M=$SELECT($EXTRACT(CONDLP,4)=1:70,1:43)
                   GOTO TURN
 +1        IF WD1="WATER"!(WD1="OIL")
               IF WD2="PLANT"!(WD2="DOOR")
                   SET WD2="POUR"
                   SET WD2X=^ADV(WD2)
 +2        GOTO WD2A
WD2        SET WD1=WD2
           SET W1=W2
           SET U1=U2
           SET WD1X=WD2X
           SET (WD2,W2,U2,WD2X)=""
WD2A       IF WD1X=""
               SET I=$RANDOM(10000)
               SET M=$SELECT(I<2000:13,I<3600:61,1:60)
               GOTO TURN
 +1        IF U1="WEST"
               IF $RANDOM(10000)<2000
                   SET M=17
                   DO SPK
 +2        GOTO @$PIECE("TRAVEL/OBJECT/ACTION/SPEC","/",$EXTRACT(WD1X))
TRAVEL     SET LNEW=LP
           SET MOV=WD1
           SET MOX=$EXTRACT(WD1X,2,99)
           IF MOX?3U.E
               DO @MOX
               GOTO NEWLP^ADV2
 +1        SET LP2=LP1
           SET LP1=LP
TR1        IF $DATA(^ADV(LP,MOV,0))
               FOR J=1:1:^(0)
                   SET Y=^ADV(LP,MOV,J)
                   XECUTE $PIECE(Y,"\",1)
                  IF $TEST
                       SET RET="NEWLP^ADV2"
                       DO @$PIECE(Y,"\",2)
                       GOTO @RET
 +1        SET M=$SELECT(VERB="FIND"!(VERB="INVEN"):59,MOX:MOX,1:12)
           DO SPK
           GOTO NEWLP^ADV2
TR2        SET LNEW=$PIECE(Y,"\",3)
           QUIT 
TR3        SET M=$PIECE(Y,"\",3)
           DO SPK
           QUIT 
OBJECT     SET (O,OBJ)=WD1
           DO HERE
          IF '$TEST
               IF ^ADVG(G,O,"F")-LP
                   GOTO OBJ2
OBJ1       IF WD2]""
               GOTO WD2
           IF VERB]""
               GOTO ACT1
           IF S
               WRITE !
           WRITE !,"What do you want to do with the ",W1,"?"
           GOTO TU1
OBJ2       IF OBJ="GRATE"

ADV3   3083     printed  Mar 25, 2016@15:27:03                                                                             Page 20

               SET OBJ=$SELECT(LP=1!(LP=4)!(LP=7):"DEPRE",LP>9&(LP<15):"ENTRA",1:OBJ)
               IF OBJ'="GRATE"
                   SET WD1=OBJ
                   SET WD1X=^ADV(OBJ)
                   GOTO TRAVEL
 +1        IF OBJ="DWARF"
               IF DFLAG>1
                   FOR DW=1:1:5
                       IF LD(DW)=LP
                           GOTO OBJ1
 +2        IF OBJ=$PIECE("WATER/OIL","/",$EXTRACT(CONDLP,4))
               GOTO OBJ1
 +3        DO LIQ
           IF O=OBJ
               SET O="BOTTL"
               DO HERE
              IF $TEST
                   GOTO OBJ1
 +4        IF OBJ="PLANT"
               SET O="PLANT2"
               DO AT
              IF $TEST
                   IF ^ADVG(G,O,"P")=0
                       SET OBJ=O
                       GOTO OBJ1
 +5        IF OBJ="ROD"
               SET O="ROD2"
               DO HERE
              IF $TEST
                   SET OBJ=O
                   GOTO OBJ1
 +6        IF OBJ="KNIFE"
               IF KNFL=LP
                   SET KNFL=-1
                   SET M=116
                   GOTO TURN
 +7        IF OBJ="BRIEF"
               IF WD2=""
                   SET WD2="ON"
                   SET WD2X=^ADV("ON")
               GOTO OBJ1
OBNONE     IF WD2=""
               IF VERB="FIND"!(VERB="INVEN")
                   GOTO OBJ1
 +1        IF S
               WRITE !
           WRITE !,"I don't see any ",W1,"."
           SET M=0
           GOTO TURN
ACTION     SET VERB=WD1
           SET VBX=WD1X
           IF VERB="SAY"
               SET OBJ=WD2
 +1       IF '$TEST
               IF WD2]""
                   GOTO WD2
ACT1       SET M=$PIECE(VBX,"/",2)
           SET RET="TURN"
           DO @$PIECE(VBX,"/",OBJ]""+3)
           GOTO @RET
AVQ        QUIT 
SPEC 

ADV3   3083     printed  Mar 25, 2016@15:27:03                                                                             Page 21

           SET M=$EXTRACT(WD1X,2,99)
           GOTO TURN
GETIN      DO KBD
 +1        SET W1=$PIECE(W," ",1)
           SET W2=$PIECE(W," ",2)
           SET U1=$EXTRACT($PIECE(U," ",1),1,5)
           SET U2=$EXTRACT($PIECE(U," ",2),1,5)
           KILL U
           QUIT 
KBD        IF S
               WRITE !
           READ !,W:600
           IF '$TEST
               GOTO TIMO^ADV
 +1       ;MSM;24Apr89
           IF W="^"!(W="^Q")
               SET W="QUIT"
 +2        SET U=W
           FOR I=1:1
               IF U?.CNPU
                   QUIT 
               IF $EXTRACT(U,I)?1L
                   SET U=$EXTRACT(U,1,I-1)_$CHAR($ASCII(U,I)-32)_$EXTRACT(U,I+1,99)
 +3        KILL I
           QUIT 
SPK        IF S
               WRITE !
           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1        KILL I
           QUIT 
PSPK       SET N=^ADV(O,P,0)
           IF N
               IF S
                   WRITE !
               FOR I=.1:.1:N
                   WRITE !,^(I)
 +1        KILL I,N
           QUIT 
HERE       SET L=^ADVG(G,O,"L")
           IF L<0!(L=LP)
 +1        KILL L
           QUIT 
AT         IF ^ADVG(G,O,"L")=LP!(^("F")=LP)
 +1        QUIT 
LIQ        SET O=^ADVG(G,"BOTTL","P")
           IF O<0
               SET O=-1-O
           SET O=$PIECE("WATER//OIL","/",O+1)
           QUIT 


ADV3     * *  59 Lines,  3083 Bytes, Checksum: B10628377                                              Mar 25, 2016@15:27:03 page 22
              85 bytes in comments
ADV3     ;ADVENTURE.  FLH ; 27 JAN 83  12:32 PM
         ;PRX;24Apr89 18:52;Copyright (c) 1989 PRx, Inc.
TURN     S (VERB,OBJ)="" D:M SPK
TU1      F J=4:1:9 I 'HINTED(J) S HINTLC(J)=$S($E(CONDLP,5)=J:HINTLC(J)+1,1:0) I HINTLC(J)'<HINTH(J) D HINT^ADV9
         I CLOSED,TOTING["/OYSTE/" S O="OYSTE",P=1 I ^ADVG(G,O,"P")<0 D PSPK
         I CLOSED F J=2:1:HOLDNG+1 S O=$P(TOTING,"/",J),P=^ADVG(G,O,"P") I P<0 S ^("P")=-P-1
         S WZDARK=DARK I KNFL>0,KNFL-LP S KNFL=0
         D GETIN
TU3      S FOOBAR=$S(FOOBAR>0:-FOOBAR,1:0),TURNS=TURNS+1,WD1=U1,WD2=U2,(WD1X,WD2X)=""
G1       I WD1?1.U.E,$D(^ADV(WD1)) S WD1X=^(WD1) I WD1X?1"0".E S WD1=$E(WD1X,2,99) G G1
G2       I WD2?1.U.E,$D(^ADV(WD2)) S WD2X=^(WD2) I WD2X?1"0".E S WD2=$E(WD2X,2,99) G G2
         I TALLY=0,LP>14,LP-33 S CLK1=CLK1-1 I CLK1=0 D CLOSEUP^ADV8 G WD1
         I CLK1<0 S CLK2=CLK2-1 I CLK2=0 D CLOSED^ADV8 G NEWLP^ADV2
         S LIMIT=LIMIT-LIT I LIMIT<31 D LAMP^ADV8 I GAVEUP G SCORE^ADV8
WD1      I WD1="ENTER",WD2="WATER"!(WD2="STREA") S M=$S($E(CONDLP,4)=1:70,1:43) G TURN
         I WD1="WATER"!(WD1="OIL"),WD2="PLANT"!(WD2="DOOR") S WD2="POUR",WD2X=^ADV(WD2)
         G WD2A
WD2      S WD1=WD2,W1=W2,U1=U2,WD1X=WD2X,(WD2,W2,U2,WD2X)=""
WD2A     I WD1X="" S I=$R(10000),M=$S(I<2000:13,I<3600:61,1:60) G TURN
         I U1="WEST",$R(10000)<2000 S M=17 D SPK
         G @$P("TRAVEL/OBJECT/ACTION/SPEC","/",$E(WD1X))
TRAVEL   S LNEW=LP,MOV=WD1,MOX=$E(WD1X,2,99) I MOX?3U.E D @MOX G NEWLP^ADV2
         S LP2=LP1,LP1=LP
TR1      I $D(^ADV(LP,MOV,0)) F J=1:1:^(0) S Y=^ADV(LP,MOV,J) X $P(Y,"\",1) I  S RET="NEWLP^ADV2" D @$P(Y,"\",2) G @RET
         S M=$S(VERB="FIND"!(VERB="INVEN"):59,MOX:MOX,1:12) D SPK G NEWLP^ADV2
TR2      S LNEW=$P(Y,"\",3) Q
TR3      S M=$P(Y,"\",3) D SPK Q
OBJECT   S (O,OBJ)=WD1 D HERE E  I ^ADVG(G,O,"F")-LP G OBJ2
OBJ1     G WD2:WD2]"",ACT1:VERB]"" W:S ! W !,"What do you want to do with the ",W1,"?" G TU1
OBJ2     I OBJ="GRATE" S OBJ=$S(LP=1!(LP=4)!(LP=7):"DEPRE",LP>9&(LP<15):"ENTRA",1:OBJ) I OBJ'="GRATE" S WD1=OBJ,WD1X=^ADV(OBJ) G TRA
          VEL
         I OBJ="DWARF",DFLAG>1 F DW=1:1:5 I LD(DW)=LP G OBJ1
         I OBJ=$P("WATER/OIL","/",$E(CONDLP,4)) G OBJ1
         D LIQ I O=OBJ S O="BOTTL" D HERE I  G OBJ1
         I OBJ="PLANT" S O="PLANT2" D AT I  I ^ADVG(G,O,"P")=0 S OBJ=O G OBJ1
         I OBJ="ROD" S O="ROD2" D HERE I  S OBJ=O G OBJ1
         I OBJ="KNIFE",KNFL=LP S KNFL=-1,M=116 G TURN
         I OBJ="BRIEF" S:WD2="" WD2="ON",WD2X=^ADV("ON") G OBJ1
OBNONE   I WD2="",VERB="FIND"!(VERB="INVEN") G OBJ1
         W:S ! W !,"I don't see any ",W1,"." S M=0 G TURN
ACTION   S VERB=WD1,VBX=WD1X I VERB="SAY" S OBJ=WD2
         E  G:WD2]"" WD2
ACT1     S M=$P(VBX,"/",2),RET="TURN" D @$P(VBX,"/",OBJ]""+3) G @RET
AVQ      Q
SPEC     S M=$E(WD1X,2,99) G TURN
GETIN    D KBD
         S W1=$P(W," ",1),W2=$P(W," ",2),U1=$E($P(U," ",1),1,5),U2=$E($P(U," ",2),1,5) K U Q
KBD      W:S ! R !,W:600 G:'$T TIMO^ADV
         I W="^"!(W="^Q") S W="QUIT" ;MSM;24Apr89
         S U=W F I=1:1 Q:U?.CNPU  I $E(U,I)?1L S U=$E(U,1,I-1)_$C($A(U,I)-32)_$E(U,I+1,99)
         K I Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
PSPK     S N=^ADV(O,P,0) I N W:S ! F I=.1:.1:N W !,^(I)
         K I,N Q
HERE     S L=^ADVG(G,O,"L") I L<0!(L=LP)
         K L Q
AT       I ^ADVG(G,O,"L")=LP!(^("F")=LP)


ADV3     * *  59 Lines,  3083 Bytes, Checksum: B10628377                                              Mar 25, 2016@15:27:03 page 23
         Q
LIQ      S O=^ADVG(G,"BOTTL","P") S:O<0 O=-1-O S O=$P("WATER//OIL","/",O+1) Q
*****   ERRORS & WARNINGS IN ADV3   *****
   ADV3+1       S - 2nd line of routine violates the SAC.
   GETIN+1      S - Kill of a protected variable (U).

*****   INDEX OF ADV3   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> CLK1         G2+1*,G2+2
>> CLK2         G2+2*
>> CLOSED       TU1+1,TU1+2
>> CONDLP       TU1,WD1,OBJ2+2
>> DARK         TU1+3
>> DFLAG        OBJ2+1
>> DW           OBJ2+1*
>> FOOBAR       TU3*
>> G            TU1+1,TU1+2,OBJECT,OBJ2+4,HERE,AT,LIQ
>> GAVEUP       G2+3
>> HINTED(      TU1
>> HINTH(       TU1
>> HINTLC(      TU1*
>> HOLDNG       TU1+2
   I            WD2A*,KBD+2*,KBD+3!,SPK*,SPK+1!,PSPK*,PSPK+1!
>> J            TU1*,TU1+2*,TR1*
>> KNFL         TU1+3*,OBJ2+6*
   L            HERE*,HERE+1!
>> LD(          OBJ2+1
>> LIMIT        G2+3*
>> LIT          G2+3
>> LNEW         TRAVEL*,TR2*
>> LP           TU1+3,G2+1,TRAVEL,TRAVEL+1,TR1,OBJECT,OBJ2,OBJ2+1,OBJ2+6,HERE,AT
>> LP1          TRAVEL+1*
>> LP2          TRAVEL+1*
>> M            TURN,WD1*,WD2A*,WD2A+1*,TR1+1*,TR3*,OBJ2+6*,OBNONE+1*,ACT1*,SPEC*,SPK
>> MOV          TRAVEL*,TR1
>> MOX          TRAVEL*,TR1+1
   N            PSPK*,PSPK+1!
>> O            TU1+1*,TU1+2*,OBJECT*,OBJ2+3*,OBJ2+4*,OBJ2+5*,PSPK,HERE,AT,LIQ*
>> OBJ          TURN*,OBJECT*,OBJ2*,OBJ2+1,OBJ2+2,OBJ2+3,OBJ2+4*,OBJ2+5*,OBJ2+6,OBJ2+7,ACTION*,ACT1
>> P            TU1+1*,TU1+2*,PSPK
>> RET          TR1*,ACT1*
>> S            OBJ1,OBNONE+1,KBD,SPK,PSPK
>> TALLY        G2+1
>> TOTING       TU1+1,TU1+2
>> TURNS        TU3*
   U            GETIN+1!,KBD+2*
>> U1           TU3,WD2*,WD2A+1,GETIN+1*
>> U2           TU3,WD2*,GETIN+1*
>> VBX          ACTION*,ACT1
>> VERB         TURN*,TR1+1,OBJ1,OBNONE,ACTION*
>> W            GETIN+1,KBD*,KBD+1*,KBD+2
>> W1           WD2*,OBJ1,OBNONE+1,GETIN+1*
>> W2           WD2*,GETIN+1*
>> WD1          TU3*,G1*,WD1,WD1+1,WD2*,TRAVEL,OBJECT,OBJ2*,ACTION
>> WD1X         TU3*,G1*,WD2*,WD2A,WD2A+2,TRAVEL,OBJ2*,ACTION,SPEC
>> WD2          TU3*,G2*,WD1,WD1+1*,WD2*,OBJ1,OBJ2+7*,OBNONE,ACTION,ACTION+1


*****   INDEX OF ADV3   *****                                                                         Mar 25, 2016@15:27:03 page 24

Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> WD2X         TU3*,G2*,WD1+1*,WD2*,OBJ2+7*
>> WZDARK       TU1+3*
>> Y            TR1*,TR2,TR3

Global Variables  ( * Changed  ! Killed)
   ^ADV(               G1,G2,WD1+1,TR1,OBJ2,PSPK
   ^ADV("ON"           OBJ2+7
   ^ADV("t"            SPK
   ^ADVG(              TU1+1,TU1+2,OBJECT,OBJ2+4,HERE,AT,LIQ

Naked Globals
   ^(           G1,G2,SPK,PSPK
   ^("F"        AT
   ^("P"        TU1+2*
   ^(0          TR1

Marked Items
   NONE

Label References
   @(           WD2A+2,TRAVEL,TR1,ACT1
   ACT1         OBJ1
   AT           OBJ2+4
   G1           G1
   G2           G2
   GETIN        TU1+4
   HERE         OBJECT,OBJ2+3,OBJ2+5
   KBD          GETIN
   LIQ          OBJ2+3
   OBJ1         OBJ2+1,OBJ2+2,OBJ2+3,OBJ2+4,OBJ2+5,OBJ2+7,OBNONE
   OBJ2         OBJECT
   PSPK         TU1+1
   SPK          TURN,WD2A+1,TR1+1,TR3
   TRAVEL       OBJ2
   TU1          OBJ1
   TURN         WD1,WD2A,OBJ2+6,OBNONE+1,SPEC
   WD1          G2+1
   WD2          OBJ1,ACTION+1
   WD2A         WD1+2

External References
   TIMO^ADV            KBD
   NEWLP^ADV2          G2+2,TRAVEL,TR1+1
   CLOSED^ADV8         G2+2
   CLOSEUP^ADV8        G2+1
   LAMP^ADV8           G2+3
   SCORE^ADV8          G2+3
   HINT^ADV9           TU1

*****   END   *****

ADV4   3143     printed  Mar 25, 2016@15:27:03                                                                             Page 25

ADV4      ;ADVENTURE.  FLH ; 04 FEB 83  4:30 AM
AVC        IF OBJ="DWARF"
               IF CLOSED
                   SET M=199
                   DO SPK
                   GOTO RUCKUS
 +1        QUIT 
AVD        SET I=TOTING[("/"_OBJ_"/")
           IF OBJ="ROD"
               IF 'I
                   IF TOTING["/ROD2/"
                       SET OBJ="ROD2"
                       SET I=1
 +1        IF 'I
               QUIT 
           SET M=54
 +2        IF OBJ="BIRD"
               SET O="SNAKE"
               DO HERE
              IF $TEST
                   SET M=30
                   DO SPK
                   IF CLOSED
                       GOTO RUCKUS
                   SET M=0
                   SET L=0
                   DO MOVE
                   SET ^ADVG(G,O,"P")=1
                   GOTO AVDL
 +3        IF OBJ="COINS"
               SET O="MACHI"
               DO HERE
              IF $TEST
                   SET L=0
                   SET O="COINS"
                   DO MOVE
                   SET L=LP
                   SET O="BATTE"
                   SET P=0
                   SET M=0
                   DO DROP
                   DO PSPK
                   QUIT 
 +4        IF OBJ="BIRD"
               SET O="DRAGO"
               DO AT
              IF $TEST
                   IF ^ADVG(G,O,"P")=0
                       SET M=154
                       SET L=0
                       SET O="BIRD"
                       SET ^ADVG(G,O,"P")=0
                       DO MOVE
                       IF ^ADVG(G,"SNAKE","L")=19
                           SET TALLY2=TALLY2+1
                       QUIT 
 +5        IF OBJ="BEAR"
               SET O="TROLL"
               DO AT
              IF $TEST
                   SET ^ADVG(G,O,"P")=2

ADV4   3143     printed  Mar 25, 2016@15:27:03                                                                             Page 26

                   SET M=163
                   DO TROLLX
                   GOTO AVDL
AVDV       IF OBJ="VASE"
               IF LP-96
                   SET O="PILLO"
                   DO AT
                   SET O="VASE"
                   SET (P,^ADVG(G,O,"P"))=$SELECT($TEST:0,1:2)
                   SET P=P+1
                   SET M=0
                   IF P-1
                       SET ^("F")=-1
                   DO PSPK
AVDL       DO LIQ
           IF O=OBJ
               SET OBJ="BOTTL"
           IF OBJ="BOTTL"
               IF O]""
                   SET L=0
                   DO DROP
 +1       IF '$TEST
               IF OBJ="CAGE"
                   IF ^ADVG(G,"BIRD","P")
                       SET O="BIRD"
                       SET L=LP
                       DO DROP
                       IF 1
 +2       IF '$TEST
               IF OBJ="BIRD"
                   SET ^ADVG(G,"BIRD","P")=0
 +3        SET O=OBJ
           SET L=LP
           DO DROP
           QUIT 
RUCKUS     SET RET="SCORE^ADV8"
           SET M=136
           DO SPK
           QUIT 
TROLLX     SET O="TROLL"
           SET L=0
           DO MOVE
           DO MOVEF
           SET O="TROLL2"
           SET L=117
           DO MOVE
           SET L=122
           DO MOVEF
           SET O="CHASM"
           DO JUGGLE
           QUIT 
AVJ        SET I=TOTING[("/"_OBJ_"/")
           IF OBJ="ROD"
               IF 'I
                   IF TOTING["/ROD2/"
                       SET OBJ="ROD2"
                       SET I=1
 +1        IF 'I
               QUIT 
           IF TR[("/"_OBJ_"/")
               SET O="TROLL"

ADV4   3143     printed  Mar 25, 2016@15:27:03                                                                             Page 27

               DO AT
              IF $TEST
                   SET M=159
                   SET L=0
                   SET O=OBJ
                   DO DROP
                   DO TROLLX
                   QUIT 
 +2        IF OBJ="FOOD"
               SET O="BEAR"
               DO HERE
              IF $TEST
                   SET OBJ=O
                   GOTO AVK3^ADV6
 +3        IF OBJ'="AXE"
               GOTO AVD^ADV4
           FOR DW=1:1:5
               IF LD(DW)=LP
                   GOTO AVJ1
 +4        SET M=152
           SET O="DRAGO"
           DO AT
          IF $TEST
               IF ^ADVG(G,O,"P")=0
                   GOTO AVJ2
 +5        SET M=158
           SET O="TROLL"
           DO AT
          IF $TEST
               GOTO AVJ2
 +6        SET O="BEAR"
           DO HERE
          IF $TEST
               IF ^ADVG(G,O,"P")=0
                   DO JUGGLE
                   SET M=164
                   SET L=LP
                   SET O="AXE"
                   DO DROP
                   SET ^ADVG(G,O,"F")=-1
                   SET ^("P")=1
                   QUIT 
 +7        SET OBJ=""
           GOTO AVA^ADV5
AVJ1       SET M=48
           IF $RANDOM(10000)<6667
               SET (DSEEN(DW),LD(DW))=0
               SET DKILL=DKILL+1
               SET M=$SELECT(DKILL=1:149,1:47)
AVJ2       DO SPK
           SET O="AXE"
           SET (L,LNEW)=LP
           SET RET="NEWLP^ADV2"
           DO DROP
           QUIT 
AVW        SET I=TOTING[("/"_OBJ_"/")
           SET J=(OBJ="ROD")
           IF 'I
               IF TOTING'["/ROD2/"!'J
                   SET M=29
 +1        IF I

ADV4   3143     printed  Mar 25, 2016@15:27:03                                                                             Page 28

               IF J
                   IF 'CLOSNG
                       SET O="FISSU"
                       DO AT
                      IF $TEST
                           SET (P,^("P"))=1-^ADVG(G,O,"P")
                           SET P=2-P
                           SET M=0
                           DO PSPK
 +2        QUIT 
AVX        IF OBJ="VASE"
               IF ^ADVG(G,OBJ,"P")=0
                   SET ^("P")=2
                   SET ^("F")=-1
                   SET M=198
                   SET O=OBJ
                   SET L=LP
                   IF TOTING["/VASE/"
                       DO DROP
                   QUIT 
 +1        IF OBJ="MIRRO"
               SET M=148
               IF CLOSED
                   SET M=197
                   DO SPK
                   GOTO RUCKUS
 +2        QUIT 
AVY        SET M=0
           IF WD2]""
               SET WD1=WD2
               SET W1=W2
               SET U1=U2
               SET WD1X=WD2X
 +1        IF "/XYZZY/PLUGH/PLOVE/FEE/"[("/"_WD1_"/")
               SET (WD2,OBJ)=""
               SET RET="WD2A"
 +2       IF '$TEST
               IF S
                   WRITE !
               WRITE !,"Okay, ",W1,"."
 +3        QUIT 
SPK        IF S
               WRITE !
           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1        KILL I
           QUIT 
PSPK       SET N=^ADV(O,P,0)
           IF N
               IF S
                   WRITE !
               FOR I=.1:.1:N
                   WRITE !,^(I)
 +1        KILL I,N
           QUIT 
DROPF      SET ^ADVG(G,O,"F")=L
           GOTO DR1
DROP       FOR Z=2:1:HOLDNG+1
               IF $PIECE(TOTING,"/",Z)=O
                   SET TOTING=$PIECE(TOTING,"/",1,Z-1)_"/"_$PIECE(TOTING,"/",Z+1,99)
                   SET HOLDNG=HOLDNG-1

ADV4   3143     printed  Mar 25, 2016@15:27:03                                                                             Page 29

                   QUIT 
 +1        SET ^ADVG(G,O,"L")=L
DR1        IF L>0
               SET ^("O")="/"_O_^ADVG(G,L,"O")
 +1        QUIT 
CARRY      IF TOTING[("/"_O_"/")
               QUIT 
           SET ^ADVG(G,O,"L")=-1
           SET HOLDNG=HOLDNG+1
           SET TOTING="/"_O_TOTING
CARRYF     SET Y=^ADVG(G,L,"O")
           FOR Z=2:1:$LENGTH(Y,"/")-1
               IF $PIECE(Y,"/",Z)=O
                   SET ^("O")=$PIECE(Y,"/",1,Z-1)_"/"_$PIECE(Y,"/",Z+1,99)
                   QUIT 
 +1        KILL Y,Z
           QUIT 
MOVEF      SET MOL=L
           SET L=^ADVG(G,O,"F")
           IF L>0
               DO CARRYF
           SET L=MOL
           DO DROPF
           QUIT 
MOVE       SET MOL=L
           SET L=^ADVG(G,O,"L")
           IF L>0
               DO CARRY
           SET L=MOL
           DO DROP
           QUIT 
HERE       SET L=^ADVG(G,O,"L")
           IF L<0!(L=LP)
 +1        KILL L
           QUIT 
AT         IF ^ADVG(G,O,"L")=LP!(^("F")=LP)
 +1        QUIT 
JUGGLE     SET L=^ADVG(G,O,"L")
           IF L>0
               SET X=^ADVG(G,L,"O")
               SET K=$FIND(X,"/"_O_"/")
               IF K
                   SET ^("O")="/"_O_$EXTRACT(X,1,K-$LENGTH(O)-2)_$EXTRACT(X,K,255)
 +1        KILL K,L,X
           QUIT 
LIQ        SET O=^ADVG(G,"BOTTL","P")
           IF O<0
               SET O=-1-O
           SET O=$PIECE("WATER//OIL","/",O+1)
           QUIT 


ADV4     * *  57 Lines,  3143 Bytes, Checksum: B11794476                                              Mar 25, 2016@15:27:03 page 30
              37 bytes in comments
ADV4     ;ADVENTURE.  FLH ; 04 FEB 83  4:30 AM
AVC      I OBJ="DWARF",CLOSED S M=199 D SPK G RUCKUS
         Q
AVD      S I=TOTING[("/"_OBJ_"/") I OBJ="ROD",'I,TOTING["/ROD2/" S OBJ="ROD2",I=1
         Q:'I  S M=54
         I OBJ="BIRD" S O="SNAKE" D HERE I  S M=30 D SPK G:CLOSED RUCKUS S M=0,L=0 D MOVE S ^ADVG(G,O,"P")=1 G AVDL
         I OBJ="COINS" S O="MACHI" D HERE I  S L=0,O="COINS" D MOVE S L=LP,O="BATTE",P=0,M=0 D DROP,PSPK Q
         I OBJ="BIRD" S O="DRAGO" D AT I  I ^ADVG(G,O,"P")=0 S M=154,L=0,O="BIRD",^ADVG(G,O,"P")=0 D MOVE S:^ADVG(G,"SNAKE","L")=19 
          TALLY2=TALLY2+1 Q
         I OBJ="BEAR" S O="TROLL" D AT I  S ^ADVG(G,O,"P")=2,M=163 D TROLLX G AVDL
AVDV     I OBJ="VASE",LP-96 S O="PILLO" D AT S O="VASE",(P,^ADVG(G,O,"P"))=$S($T:0,1:2),P=P+1,M=0 S:P-1 ^("F")=-1 D PSPK
AVDL     D LIQ S:O=OBJ OBJ="BOTTL" I OBJ="BOTTL",O]"" S L=0 D DROP
         E  I OBJ="CAGE",^ADVG(G,"BIRD","P") S O="BIRD",L=LP D DROP I 1
         E  I OBJ="BIRD" S ^ADVG(G,"BIRD","P")=0
         S O=OBJ,L=LP D DROP Q
RUCKUS   S RET="SCORE^ADV8",M=136 D SPK Q
TROLLX   S O="TROLL",L=0 D MOVE,MOVEF S O="TROLL2",L=117 D MOVE S L=122 D MOVEF S O="CHASM" D JUGGLE Q
AVJ      S I=TOTING[("/"_OBJ_"/") I OBJ="ROD",'I,TOTING["/ROD2/" S OBJ="ROD2",I=1
         Q:'I  I TR[("/"_OBJ_"/") S O="TROLL" D AT I  S M=159,L=0,O=OBJ D DROP,TROLLX Q
         I OBJ="FOOD" S O="BEAR" D HERE I  S OBJ=O G AVK3^ADV6
         G:OBJ'="AXE" AVD^ADV4 F DW=1:1:5 I LD(DW)=LP G AVJ1
         S M=152,O="DRAGO" D AT I  I ^ADVG(G,O,"P")=0 G AVJ2
         S M=158,O="TROLL" D AT I  G AVJ2
         S O="BEAR" D HERE I  I ^ADVG(G,O,"P")=0 D JUGGLE S M=164,L=LP,O="AXE" D DROP S ^ADVG(G,O,"F")=-1,^("P")=1 Q
         S OBJ="" G AVA^ADV5
AVJ1     S M=48 I $R(10000)<6667 S (DSEEN(DW),LD(DW))=0,DKILL=DKILL+1,M=$S(DKILL=1:149,1:47)
AVJ2     D SPK S O="AXE",(L,LNEW)=LP,RET="NEWLP^ADV2" D DROP Q
AVW      S I=TOTING[("/"_OBJ_"/"),J=(OBJ="ROD") I 'I,TOTING'["/ROD2/"!'J S M=29
         I I,J,'CLOSNG S O="FISSU" D AT I  S (P,^("P"))=1-^ADVG(G,O,"P"),P=2-P,M=0 D PSPK
         Q
AVX      I OBJ="VASE",^ADVG(G,OBJ,"P")=0 S ^("P")=2,^("F")=-1,M=198,O=OBJ,L=LP D:TOTING["/VASE/" DROP Q
         I OBJ="MIRRO" S M=148 I CLOSED S M=197 D SPK G RUCKUS
         Q
AVY      S M=0 I WD2]"" S WD1=WD2,W1=W2,U1=U2,WD1X=WD2X
         I "/XYZZY/PLUGH/PLOVE/FEE/"[("/"_WD1_"/") S (WD2,OBJ)="",RET="WD2A"
         E  W:S ! W !,"Okay, ",W1,"."
         Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
PSPK     S N=^ADV(O,P,0) I N W:S ! F I=.1:.1:N W !,^(I)
         K I,N Q
DROPF    S ^ADVG(G,O,"F")=L G DR1
DROP     F Z=2:1:HOLDNG+1 I $P(TOTING,"/",Z)=O S TOTING=$P(TOTING,"/",1,Z-1)_"/"_$P(TOTING,"/",Z+1,99),HOLDNG=HOLDNG-1 Q
         S ^ADVG(G,O,"L")=L
DR1      I L>0 S ^("O")="/"_O_^ADVG(G,L,"O")
         Q
CARRY    Q:TOTING[("/"_O_"/")  S ^ADVG(G,O,"L")=-1,HOLDNG=HOLDNG+1,TOTING="/"_O_TOTING
CARRYF   S Y=^ADVG(G,L,"O") F Z=2:1:$L(Y,"/")-1 I $P(Y,"/",Z)=O S ^("O")=$P(Y,"/",1,Z-1)_"/"_$P(Y,"/",Z+1,99) Q
         K Y,Z Q
MOVEF    S MOL=L,L=^ADVG(G,O,"F") D:L>0 CARRYF S L=MOL D DROPF Q
MOVE     S MOL=L,L=^ADVG(G,O,"L") D:L>0 CARRY S L=MOL D DROP Q
HERE     S L=^ADVG(G,O,"L") I L<0!(L=LP)
         K L Q
AT       I ^ADVG(G,O,"L")=LP!(^("F")=LP)
         Q
JUGGLE   S L=^ADVG(G,O,"L") I L>0 S X=^ADVG(G,L,"O"),K=$F(X,"/"_O_"/") I K S ^("O")="/"_O_$E(X,1,K-$L(O)-2)_$E(X,K,255)
         K K,L,X Q
LIQ      S O=^ADVG(G,"BOTTL","P") S:O<0 O=-1-O S O=$P("WATER//OIL","/",O+1) Q
*****   ERRORS & WARNINGS IN ADV4   *****


ADV4     * *  57 Lines,  3143 Bytes, Checksum: B11794476                                              Mar 25, 2016@15:27:03 page 31

*****   ERRORS & WARNINGS IN ADV4   *****
   ADV4+1       S - 2nd line of routine violates the SAC.

*****   INDEX OF ADV4   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> CLOSED       AVC,AVD+2,AVX+1
>> CLOSNG       AVW+1
>> DKILL        AVJ1*
>> DSEEN(       AVJ1*
>> DW           AVJ+3*,AVJ1
>> G            AVD+2,AVD+4,AVD+5,AVDV,AVDL+1,AVDL+2,AVJ+4,AVJ+6,AVW+1,AVX,DROPF,DROP+1,DR1,CARRY,CARRYF,MOVEF,MOVE,HERE,AT,JUGGLE
                LIQ
>> HOLDNG       DROP*,CARRY*
   I            AVD*,AVD+1,AVJ*,AVJ+1,AVW*,AVW+1,SPK*,SPK+1!,PSPK*,PSPK+1!
>> J            AVW*,AVW+1
   K            JUGGLE*,JUGGLE+1!
   L            AVD+2*,AVD+3*,AVD+4*,AVDL*,AVDL+1*,AVDL+3*,TROLLX*,AVJ+1*,AVJ+6*,AVJ2*,AVX*,DROPF,DROP+1,DR1,CARRYF,MOVEF*,MOVE*
                HERE*,HERE+1!,JUGGLE*,JUGGLE+1!
>> LD(          AVJ+3,AVJ1*
>> LNEW         AVJ2*
>> LP           AVD+3,AVDV,AVDL+1,AVDL+3,AVJ+3,AVJ+6,AVJ2,AVX,HERE,AT
>> M            AVC*,AVD+1*,AVD+2*,AVD+3*,AVD+4*,AVD+5*,AVDV*,RUCKUS*,AVJ+1*,AVJ+4*,AVJ+5*,AVJ+6*,AVJ1*,AVW*,AVW+1*,AVX*,AVX+1*
                AVY*,SPK
>> MOL          MOVEF*,MOVE*
   N            PSPK*,PSPK+1!
>> O            AVD+2*,AVD+3*,AVD+4*,AVD+5*,AVDV*,AVDL,AVDL+1*,AVDL+3*,TROLLX*,AVJ+1*,AVJ+2*,AVJ+4*,AVJ+5*,AVJ+6*,AVJ2*,AVW+1*,AVX*
                PSPK,DROPF,DROP,DROP+1,DR1,CARRY,CARRYF,MOVEF,MOVE,HERE,AT,JUGGLE,LIQ*
>> OBJ          AVC,AVD*,AVD+2,AVD+3,AVD+4,AVD+5,AVDV,AVDL*,AVDL+1,AVDL+2,AVDL+3,AVJ*,AVJ+1,AVJ+2*,AVJ+3,AVJ+7*,AVW,AVX,AVX+1
                AVY+1*
>> P            AVD+3*,AVDV*,AVW+1*,PSPK
>> RET          RUCKUS*,AVJ2*,AVY+1*
>> S            AVY+2,SPK,PSPK
>> TALLY2       AVD+4*
>> TOTING       AVD,AVJ,AVW,AVX,DROP*,CARRY*
>> TR           AVJ+1
>> U1           AVY*
>> U2           AVY
>> W1           AVY*,AVY+2
>> W2           AVY
>> WD1          AVY*,AVY+1
>> WD1X         AVY*
>> WD2          AVY,AVY+1*
>> WD2X         AVY
   X            JUGGLE*,JUGGLE+1!
   Y            CARRYF*,CARRYF+1!
   Z            DROP*,CARRYF*,CARRYF+1!

Global Variables  ( * Changed  ! Killed)
   ^ADV(               PSPK
   ^ADV("t"            SPK
   ^ADVG(              AVD+2*,AVD+4*,AVD+5*,AVDV*,AVDL+1,AVDL+2*,AVJ+4,AVJ+6*,AVW+1,AVX,DROPF*,DROP+1*,DR1,CARRY*,CARRYF,MOVEF,MOVE
                       HERE,AT,JUGGLE,LIQ

Naked Globals
   ^(           SPK,PSPK


*****   INDEX OF ADV4   *****                                                                         Mar 25, 2016@15:27:03 page 32

Naked Globals
   ^("F"        AVDV*,AVX*,AT
   ^("O"        DR1*,CARRYF*,JUGGLE*
   ^("P"        AVJ+6*,AVW+1*,AVX*

Marked Items
   NONE

Label References
   AT           AVD+4,AVD+5,AVDV,AVJ+1,AVJ+4,AVJ+5,AVW+1
   AVDL         AVD+2,AVD+5
   AVJ1         AVJ+3
   AVJ2         AVJ+4,AVJ+5
   CARRY        MOVE
   CARRYF       MOVEF
   DR1          DROPF
   DROP         AVD+3,AVDL,AVDL+1,AVDL+3,AVJ+1,AVJ+6,AVJ2,AVX,MOVE
   DROPF        MOVEF
   HERE         AVD+2,AVD+3,AVJ+2,AVJ+6
   JUGGLE       TROLLX,AVJ+6
   LIQ          AVDL
   MOVE         AVD+2,AVD+3,AVD+4,TROLLX
   MOVEF        TROLLX
   PSPK         AVD+3,AVDV,AVW+1
   RUCKUS       AVC,AVD+2,AVX+1
   SPK          AVC,AVD+2,RUCKUS,AVJ2,AVX+1
   TROLLX       AVD+5,AVJ+1

External References
   AVD^ADV4            AVJ+3
   AVA^ADV5            AVJ+7
   AVK3^ADV6           AVJ+2

*****   END   *****

ADV5   3508     printed  Mar 25, 2016@15:27:03                                                                             Page 33

ADV5      ;ADVENTURE.  FLH ; 24 JAN 83  12:58 PM
AV0        IF S
               WRITE !
           WRITE !,"I don't understand ",W1,"."
           SET OBJ=""
           SET RET="TU1"
           QUIT 
AVA        SET J=0
           IF DFLAG>1
               FOR DW=1:1:5
                   IF LD(DW)=LP
                       SET J=1
                       SET OBJ="DWARF"
                       QUIT 
 +1        SET O="SNAKE"
           DO HERE
           DO AVAJ
 +2       IF '$TEST
               SET O="DRAGO"
               IF ^ADVG(G,O,"P")=0
                   DO AT
                   DO AVAJ
 +3       IF '$TEST
               SET O="TROLL"
               DO AT
               DO AVAJ
 +4       IF '$TEST
               SET O="BEAR"
               IF ^ADVG(G,O,"P")=0
                   DO HERE
                   DO AVAJ
 +5        IF $TEST
               GOTO AV0
           IF OBJ]""
               GOTO AVA1
 +6        IF VERB'="THROW"
               SET O="BIRD"
               DO HERE
              IF $TEST
                   SET OBJ=O
 +7        FOR O="CLAM","OYSTE"
               DO HERE
               DO AVAJ
               IF $TEST
                   GOTO AV0
AVA1       IF OBJ="BIRD"
               SET M=137
               IF CLOSED
                   QUIT 
               SET O=OBJ
               SET ^ADVG(G,O,"P")=0
               SET L=0
               SET M=45
               DO MOVE
               IF ^ADVG(G,"SNAKE","L")=19
                   SET TALLY2=TALLY2+1
 +1        SET M=$SELECT(OBJ="DWARF":49,OBJ="SNAKE":46,OBJ="CLAM":150,OBJ="OYSTE":150,OBJ="":44,1:M)
 +2        IF OBJ="DWARF"
               IF CLOSED
                   GOTO RUCKUS^ADV4
 +3        SET M=$SELECT(OBJ="DRAGO":167,OBJ="TROLL":157,1:M)

ADV5   3508     printed  Mar 25, 2016@15:27:03                                                                             Page 34

           IF OBJ="BEAR"
               SET M=^ADVG(G,OBJ,"P")+1\2+165
 +4        IF OBJ'="DRAGO"!^ADVG(G,"DRAGO","P")
               QUIT 
 +5        SET (VERB,OBJ)=""
           SET M=49
           DO SPK
           DO GETIN
           IF U1'?1"Y"."ES"
               SET RET="TU3^ADV3"
               QUIT 
 +6        SET O="DRAGO"
           SET P=1
           DO PSPK
           SET ^ADVG(G,O,"P")=2
           SET ^ADVG(G,"RUG","P")=0
 +7        SET L=-1
           DO MOVEF
           SET L=120
           DO MOVE
           SET O="RUG"
           DO MOVE
           SET L=0
           DO MOVEF
 +8        SET L=120
           FOR LP=119,121
               SET X=^ADVG(G,LP,"O")
               FOR J=2:1:$LENGTH(X,"/")-1
                   SET O=$PIECE(X,"/",J)
                   DO MOVE
 +9        SET (LP,LNEW)=120
           SET RET="NEWLP^ADV2"
           QUIT 
AVAJ      IF $TEST
               SET OBJ=O
               SET J=J+1
               IF J>1
 +1        QUIT 
AVE        SET O="FOOD"
           DO HERE
          IF '$TEST
               GOTO AV0
AVE1       SET L=0
           SET M=72
           DO MOVE
           QUIT 
AVE2       IF OBJ="FOOD"
               GOTO AVE1
           IF "/BIRD/SNAKE/CLAM/OYSTE/DWARF/DRAGO/TROLL/BEAR/"[("/"_OBJ_"/")
               SET M=71
 +1        QUIT 
AVG        DO LIQ
           SET I=O="WATER"
           SET O="BOTTL"
           DO HERE
           SET J=$TEST
           IF 'J!'I
               IF OBJ=""
                   IF $EXTRACT(CONDLP,4)-1
                       GOTO AV0
 +1        IF "WATER"'[OBJ

ADV5   3508     printed  Mar 25, 2016@15:27:03                                                                             Page 35

               SET M=110
 +2       IF '$TEST
               IF I
                   IF J
                       SET ^ADVG(G,"BOTTL","P")=1
                       SET M=74
                       SET O="WATER"
                       SET L=0
                       DO DROP
 +3        QUIT 
AVI        SET N=1
           SET M=99
           FOR J=HOLDNG+1:-1:2
               SET O=$PIECE(TOTING,"/",J)
               IF O'="BEAR"
                   IF N
                       XECUTE "S N=0 D SPK"
                   WRITE !?5,$EXTRACT(^ADV(O),2,255)
 +1        SET M=$SELECT(TOTING["/BEAR/":141,N:98,1:0)
           QUIT 
AVN        IF TOTING[("/"_OBJ_"/")
               SET M=24
               QUIT 
 +1        IF CLOSED
               SET M=138
               QUIT 
 +2        SET O=OBJ
           DO AT
          IF '$TEST
               SET O="BOTTL"
               DO AT
              IF $TEST
                   DO LIQ
                   IF O=OBJ
 +3       IF '$TEST
               IF WD1=$PIECE("WATER/OIL","/",$EXTRACT(CONDLP,4))
 +4       IF '$TEST
               IF DFLAG>1
                   IF OBJ="DWARF"
                       FOR DW=1:1:5
                           IF LD(DW)=LP
                               QUIT 
 +5       IF $TEST
               SET M=94
 +6        QUIT 
AVP        IF "BOTTL"[OBJ
               DO LIQ
               SET OBJ=O
 +1        IF OBJ=""
               GOTO AV0
           IF TOTING'[("/"_OBJ_"/")
               QUIT 
           SET M=78
           IF OBJ'="WATER"
               IF OBJ'="OIL"
                   QUIT 
 +2        SET ^ADVG(G,"BOTTL","P")=1
           SET M=77
           SET L=0
           SET O=OBJ
           DO DROP
 +3 

ADV5   3508     printed  Mar 25, 2016@15:27:03                                                                             Page 36

           SET O="DOOR"
           DO AT
          IF $TEST
               SET (P,^ADVG(G,O,"P"))=OBJ="OIL"
               SET M=113+P
 +4       IF '$TEST
               SET O="PLANT"
               DO AT
              IF $TEST
                   SET M=112
                   IF OBJ="WATER"
                       SET P=^ADVG(G,O,"P")+1
                       DO PSPK
                       SET (P,^ADVG(G,O,"P"))=P+1#6
                       SET ^ADVG(G,"PLANT2","P")=P\2
                       SET LNEW=LP
                       SET RET="NEWLP^ADV2"
 +5        QUIT 
AVR        IF OBJ'="LAMP"
               SET M=76
           QUIT 
AVU        SET Q=22
           SET (Y,N)=54
           DO YES
           IF $TEST
               SET RET="SCORE^ADV8"
           SET GAVEUP=$TEST
           SET M=0
           QUIT 
GETIN      DO KBD
           SET W1=$PIECE(W," ",1)
           SET W2=$PIECE(W," ",2)
           SET U1=$EXTRACT($PIECE(U," ",1),1,5)
           SET U2=$EXTRACT($PIECE(U," ",2),1,5)
           KILL U
           QUIT 
YES        SET M=Q
           DO SPK
           DO KBD
           IF U?1"Y".1"ES"
               SET M=Y
               IF M
                   DO SPK
 +1       IF '$TEST
               IF U'?1"N".1"O"
                   WRITE "   Please answer the question."
                   GOTO YES
 +2       IF '$TEST
               SET M=N
               IF M
                   DO SPK
 +3        KILL M
           QUIT 
KBD        IF S
               WRITE !
           READ !,W:600
           IF '$TEST
               GOTO TIMO^ADV
           SET U=W
           FOR I=1:1
               IF U?.CNPU

ADV5   3508     printed  Mar 25, 2016@15:27:03                                                                             Page 37

                   QUIT 
               IF $EXTRACT(U,I)?1L
                   SET U=$EXTRACT(U,1,I-1)_$CHAR($ASCII(U,I)-32)_$EXTRACT(U,I+1,99)
 +1        KILL I
           QUIT 
SPK        IF S
               WRITE !
           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1        KILL I
           QUIT 
PSPK       SET N=^ADV(O,P,0)
           IF N
               IF S
                   WRITE !
               FOR I=.1:.1:N
                   WRITE !,^(I)
 +1        KILL I,N
           QUIT 
DROPF      SET ^ADVG(G,O,"F")=L
           GOTO DR1
DROP       FOR Z=2:1:HOLDNG+1
               IF $PIECE(TOTING,"/",Z)=O
                   SET TOTING=$PIECE(TOTING,"/",1,Z-1)_"/"_$PIECE(TOTING,"/",Z+1,99)
                   SET HOLDNG=HOLDNG-1
                   QUIT 
 +1        SET ^ADVG(G,O,"L")=L
DR1        IF L>0
               SET ^("O")="/"_O_^ADVG(G,L,"O")
 +1        QUIT 
CARRY      IF TOTING[("/"_O_"/")
               QUIT 
           SET ^ADVG(G,O,"L")=-1
           SET HOLDNG=HOLDNG+1
           SET TOTING="/"_O_TOTING
CARRYF     SET Y=^ADVG(G,L,"O")
           FOR Z=2:1:$LENGTH(Y,"/")-1
               IF $PIECE(Y,"/",Z)=O
                   SET ^("O")=$PIECE(Y,"/",1,Z-1)_"/"_$PIECE(Y,"/",Z+1,99)
                   QUIT 
 +1        KILL Y,Z
           QUIT 
MOVEF      SET MOL=L
           SET L=^ADVG(G,O,"F")
           IF L>0
               DO CARRYF
           SET L=MOL
           DO DROPF
           QUIT 
MOVE       SET MOL=L
           SET L=^ADVG(G,O,"L")
           IF L>0
               DO CARRY
           SET L=MOL
           DO DROP
           QUIT 
HERE       SET L=^ADVG(G,O,"L")
           IF L<0!(L=LP)
 +1        KILL L
           QUIT 
AT         IF ^ADVG(G,O,"L")=LP!(^("F")=LP)
 +1 

ADV5   3508     printed  Mar 25, 2016@15:27:03                                                                             Page 38

           QUIT 
LIQ        SET O=^ADVG(G,"BOTTL","P")
           IF O<0
               SET O=-1-O
           SET O=$PIECE("WATER//OIL","/",O+1)
           QUIT 


ADV5     * *  73 Lines,  3508 Bytes, Checksum: B14133104                                              Mar 25, 2016@15:27:03 page 39
              38 bytes in comments
ADV5     ;ADVENTURE.  FLH ; 24 JAN 83  12:58 PM
AV0      W:S ! W !,"I don't understand ",W1,"." S OBJ="",RET="TU1" Q
AVA      S J=0 I DFLAG>1 F DW=1:1:5 I LD(DW)=LP S J=1,OBJ="DWARF" Q
         S O="SNAKE" D HERE,AVAJ
         E  S O="DRAGO" I ^ADVG(G,O,"P")=0 D AT,AVAJ
         E  S O="TROLL" D AT,AVAJ
         E  S O="BEAR" I ^ADVG(G,O,"P")=0 D HERE,AVAJ
         G AV0:$T,AVA1:OBJ]""
         I VERB'="THROW" S O="BIRD" D HERE I  S OBJ=O
         F O="CLAM","OYSTE" D HERE,AVAJ G:$T AV0
AVA1     I OBJ="BIRD" S M=137 Q:CLOSED  S O=OBJ,^ADVG(G,O,"P")=0,L=0,M=45 D MOVE I ^ADVG(G,"SNAKE","L")=19 S TALLY2=TALLY2+1
         S M=$S(OBJ="DWARF":49,OBJ="SNAKE":46,OBJ="CLAM":150,OBJ="OYSTE":150,OBJ="":44,1:M)
         I OBJ="DWARF",CLOSED G RUCKUS^ADV4
         S M=$S(OBJ="DRAGO":167,OBJ="TROLL":157,1:M) I OBJ="BEAR" S M=^ADVG(G,OBJ,"P")+1\2+165
         Q:OBJ'="DRAGO"!^ADVG(G,"DRAGO","P")
         S (VERB,OBJ)="",M=49 D SPK,GETIN I U1'?1"Y"."ES" S RET="TU3^ADV3" Q
         S O="DRAGO",P=1 D PSPK S ^ADVG(G,O,"P")=2,^ADVG(G,"RUG","P")=0
         S L=-1 D MOVEF S L=120 D MOVE S O="RUG" D MOVE S L=0 D MOVEF
         S L=120 F LP=119,121 S X=^ADVG(G,LP,"O") F J=2:1:$L(X,"/")-1 S O=$P(X,"/",J) D MOVE
         S (LP,LNEW)=120,RET="NEWLP^ADV2" Q
AVAJ     I  S OBJ=O,J=J+1 I J>1
         Q
AVE      S O="FOOD" D HERE E  G AV0
AVE1     S L=0,M=72 D MOVE Q
AVE2     G:OBJ="FOOD" AVE1 I "/BIRD/SNAKE/CLAM/OYSTE/DWARF/DRAGO/TROLL/BEAR/"[("/"_OBJ_"/") S M=71
         Q
AVG      D LIQ S I=O="WATER",O="BOTTL" D HERE S J=$T I 'J!'I,OBJ="",$E(CONDLP,4)-1 G AV0
         I "WATER"'[OBJ S M=110
         E  I I,J S ^ADVG(G,"BOTTL","P")=1,M=74,O="WATER",L=0 D DROP
         Q
AVI      S N=1,M=99 F J=HOLDNG+1:-1:2 S O=$P(TOTING,"/",J) I O'="BEAR" X:N "S N=0 D SPK" W !?5,$E(^ADV(O),2,255)
         S M=$S(TOTING["/BEAR/":141,N:98,1:0) Q
AVN      I TOTING[("/"_OBJ_"/") S M=24 Q
         I CLOSED S M=138 Q
         S O=OBJ D AT E  S O="BOTTL" D AT I  D LIQ I O=OBJ
         E  I WD1=$P("WATER/OIL","/",$E(CONDLP,4))
         E  I DFLAG>1,OBJ="DWARF" F DW=1:1:5 I LD(DW)=LP Q
         I  S M=94
         Q
AVP      I "BOTTL"[OBJ D LIQ S OBJ=O
         G:OBJ="" AV0 Q:TOTING'[("/"_OBJ_"/")  S M=78 I OBJ'="WATER",OBJ'="OIL" Q
         S ^ADVG(G,"BOTTL","P")=1,M=77,L=0,O=OBJ D DROP
         S O="DOOR" D AT I  S (P,^ADVG(G,O,"P"))=OBJ="OIL",M=113+P
         E  S O="PLANT" D AT I  S M=112 I OBJ="WATER" S P=^ADVG(G,O,"P")+1 D PSPK S (P,^ADVG(G,O,"P"))=P+1#6,^ADVG(G,"PLANT2","P")=P
          \2,LNEW=LP,RET="NEWLP^ADV2"
         Q
AVR      S:OBJ'="LAMP" M=76 Q
AVU      S Q=22,(Y,N)=54 D YES S:$T RET="SCORE^ADV8" S GAVEUP=$T,M=0 Q
GETIN    D KBD S W1=$P(W," ",1),W2=$P(W," ",2),U1=$E($P(U," ",1),1,5),U2=$E($P(U," ",2),1,5) K U Q
YES      S M=Q D SPK,KBD I U?1"Y".1"ES" S M=Y D:M SPK
         E  I U'?1"N".1"O" W "   Please answer the question." G YES
         E  S M=N D:M SPK
         K M Q
KBD      W:S ! R !,W:600 G:'$T TIMO^ADV S U=W F I=1:1 Q:U?.CNPU  I $E(U,I)?1L S U=$E(U,1,I-1)_$C($A(U,I)-32)_$E(U,I+1,99)
         K I Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
PSPK     S N=^ADV(O,P,0) I N W:S ! F I=.1:.1:N W !,^(I)


ADV5     * *  73 Lines,  3508 Bytes, Checksum: B14133104                                              Mar 25, 2016@15:27:03 page 40
         K I,N Q
DROPF    S ^ADVG(G,O,"F")=L G DR1
DROP     F Z=2:1:HOLDNG+1 I $P(TOTING,"/",Z)=O S TOTING=$P(TOTING,"/",1,Z-1)_"/"_$P(TOTING,"/",Z+1,99),HOLDNG=HOLDNG-1 Q
         S ^ADVG(G,O,"L")=L
DR1      I L>0 S ^("O")="/"_O_^ADVG(G,L,"O")
         Q
CARRY    Q:TOTING[("/"_O_"/")  S ^ADVG(G,O,"L")=-1,HOLDNG=HOLDNG+1,TOTING="/"_O_TOTING
CARRYF   S Y=^ADVG(G,L,"O") F Z=2:1:$L(Y,"/")-1 I $P(Y,"/",Z)=O S ^("O")=$P(Y,"/",1,Z-1)_"/"_$P(Y,"/",Z+1,99) Q
         K Y,Z Q
MOVEF    S MOL=L,L=^ADVG(G,O,"F") D:L>0 CARRYF S L=MOL D DROPF Q
MOVE     S MOL=L,L=^ADVG(G,O,"L") D:L>0 CARRY S L=MOL D DROP Q
HERE     S L=^ADVG(G,O,"L") I L<0!(L=LP)
         K L Q
AT       I ^ADVG(G,O,"L")=LP!(^("F")=LP)
         Q
LIQ      S O=^ADVG(G,"BOTTL","P") S:O<0 O=-1-O S O=$P("WATER//OIL","/",O+1) Q
*****   ERRORS & WARNINGS IN ADV5   *****
   ADV5+1       S - 2nd line of routine violates the SAC.
   GETIN        S - Kill of a protected variable (U).

*****   INDEX OF ADV5   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> CLOSED       AVA1,AVA1+2,AVN+1
>> CONDLP       AVG,AVN+3
>> DFLAG        AVA,AVN+4
>> DW           AVA*,AVN+4*
>> G            AVA+2,AVA+4,AVA1,AVA1+3,AVA1+4,AVA1+6,AVA1+8,AVG+2,AVP+2,AVP+3,AVP+4,DROPF,DROP+1,DR1,CARRY,CARRYF,MOVEF,MOVE,HERE
                AT,LIQ
>> GAVEUP       AVU*
>> HOLDNG       AVI,DROP*,CARRY*
   I            AVG*,AVG+2,KBD*,KBD+1!,SPK*,SPK+1!,PSPK*,PSPK+1!
>> J            AVA*,AVA1+8*,AVAJ*,AVG*,AVG+2,AVI*
   L            AVA1*,AVA1+7*,AVA1+8*,AVE1*,AVG+2*,AVP+2*,DROPF,DROP+1,DR1,CARRYF,MOVEF*,MOVE*,HERE*,HERE+1!
>> LD(          AVA,AVN+4
>> LNEW         AVA1+9*,AVP+4*
>> LP           AVA,AVA1+8*,AVA1+9*,AVN+4,AVP+4,HERE,AT
   M            AVA1*,AVA1+1*,AVA1+3*,AVA1+5*,AVE1*,AVE2*,AVG+1*,AVG+2*,AVI*,AVI+1*,AVN*,AVN+1*,AVN+5*,AVP+1*,AVP+2*,AVP+3*,AVP+4*
                AVR*,AVU*,YES*,YES+2*,YES+3!,SPK
>> MOL          MOVEF*,MOVE*
   N            AVI*,AVI+1,AVU*,YES+2,PSPK*,PSPK+1!
>> O            AVA+1*,AVA+2*,AVA+3*,AVA+4*,AVA+6*,AVA+7*,AVA1*,AVA1+6*,AVA1+7*,AVA1+8*,AVAJ,AVE*,AVG*,AVG+2*,AVI*,AVN+2*,AVP
                AVP+2*,AVP+3*,AVP+4*,PSPK,DROPF,DROP,DROP+1,DR1,CARRY,CARRYF,MOVEF,MOVE,HERE,AT,LIQ*
>> OBJ          AV0*,AVA*,AVA+5,AVA+6*,AVA1,AVA1+1,AVA1+2,AVA1+3,AVA1+4,AVA1+5*,AVAJ*,AVE2,AVG,AVG+1,AVN,AVN+2,AVN+4,AVP*,AVP+1
                AVP+2,AVP+3,AVP+4,AVR
>> P            AVA1+6*,AVP+3*,AVP+4*,PSPK
>> Q            AVU*,YES
>> RET          AV0*,AVA1+5*,AVA1+9*,AVP+4*,AVU*
>> S            AV0,KBD,SPK,PSPK
>> TALLY2       AVA1*
>> TOTING       AVI,AVI+1,AVN,AVP+1,DROP*,CARRY*
   U            GETIN!,YES,YES+1,KBD*
>> U1           AVA1+5,GETIN*
>> U2           GETIN*
>> VERB         AVA+6,AVA1+5*
>> W            GETIN,KBD*
>> W1           AV0,GETIN*


*****   INDEX OF ADV5   *****                                                                         Mar 25, 2016@15:27:03 page 41

Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> W2           GETIN*
>> WD1          AVN+3
>> X            AVA1+8*
   Y            AVU*,YES,CARRYF*,CARRYF+1!
   Z            DROP*,CARRYF*,CARRYF+1!

Global Variables  ( * Changed  ! Killed)
   ^ADV(               AVI,PSPK
   ^ADV("t"            SPK
   ^ADVG(              AVA+2,AVA+4,AVA1*,AVA1+3,AVA1+4,AVA1+6*,AVA1+8,AVG+2*,AVP+2*,AVP+3*,AVP+4*,DROPF*,DROP+1*,DR1,CARRY*,CARRYF
                       MOVEF,MOVE,HERE,AT,LIQ

Naked Globals
   ^(           SPK,PSPK
   ^("F"        AT
   ^("O"        DR1*,CARRYF*

Marked Items
   NONE

Label References
   AT           AVA+2,AVA+3,AVN+2,AVP+3,AVP+4
   AV0          AVA+5,AVA+7,AVE,AVG,AVP+1
   AVA1         AVA+5
   AVAJ         AVA+1,AVA+2,AVA+3,AVA+4,AVA+7
   AVE1         AVE2
   CARRY        MOVE
   CARRYF       MOVEF
   DR1          DROPF
   DROP         AVG+2,AVP+2,MOVE
   DROPF        MOVEF
   GETIN        AVA1+5
   HERE         AVA+1,AVA+4,AVA+6,AVA+7,AVE,AVG
   KBD          GETIN,YES
   LIQ          AVG,AVN+2,AVP
   MOVE         AVA1,AVA1+7,AVA1+8,AVE1
   MOVEF        AVA1+7
   PSPK         AVA1+6,AVP+4
   SPK          AVA1+5,YES,YES+2
   YES          AVU,YES+1

External References
   TIMO^ADV            KBD
   RUCKUS^ADV4         AVA1+2

*****   END   *****

ADV6   3240     printed  Mar 25, 2016@15:27:03                                                                             Page 42

ADV6      ;ADVENTURE.  FLH ; 28 DEC 82  9:53 AM
AVB        IF CLOSED
               IF ^ADVG(G,"ROD2","P")'<0
                   SET O="ROD2"
                   DO HERE
                   SET @$SELECT($TEST:"M=135,BONUS=25",LP=115:"M=134,BONUS=30",1:"M=133,BONUS=45")
                   SET RET="SCORE^ADV8"
                   DO SPK
 +1        QUIT 
AVF        SET I=$EXTRACT(CONDLP,4)
           IF OBJ="VASE"
               SET M=$SELECT('I:144,1:29)
               IF TOTING'["/VASE/"!'I
                   QUIT 
               SET M=145
               DO SPK
               SET M=0
               GOTO AVDV^ADV4
 +1        IF "BOTTL"[OBJ
               SET O="BOTTL"
               DO HERE
               IF OBJ=""&'$TEST
                   GOTO AV0^ADV5
               DO LIQ
               SET M=$SELECT(O]"":105,'I:106,1:107)
               IF M=107
                   SET ^ADVG(G,"BOTTL","P")=$EXTRACT("102",I+1)
                   SET L=1
                   DO LIQ
                   IF TOTING["/BOTTL/"
                       DO CARRY
                   IF O="OIL"
                       SET M=108
 +2        QUIT 
AVK        IF OBJ="BIRD"
               SET M=100
               QUIT 
 +1        SET J=$SELECT(OBJ="TROLL":182,OBJ="DRAGO":102,1:0)
           IF J=102
               IF ^ADVG(G,OBJ,"P")
                   SET J=110
 +2        IF J
               SET M=J
               QUIT 
 +3        IF OBJ="SNAKE"
               SET M=102
               IF CLOSED
                   QUIT 
               SET O="BIRD"
               DO HERE
               IF '$TEST
                   QUIT 
               SET M=101
               SET L=0
               SET ^ADVG(G,O,"P")=0
               SET TALLY2=TALLY2+1
               DO MOVE
               QUIT 
 +4        IF OBJ="DWARF"
               SET O="FOOD"
               DO HERE

ADV6   3240     printed  Mar 25, 2016@15:27:03                                                                             Page 43

               IF '$TEST
                   QUIT 
               SET M=103
               IF DFLAG<3
                   SET DFLAG=DFLAG+1
               QUIT 
AVK3       IF OBJ="BEAR"
               SET P=^ADVG(G,OBJ,"P")
               SET M=$SELECT(P=0:102,P=3:110,1:M)
               SET O="FOOD"
               DO HERE
               IF '$TEST
                   QUIT 
               SET M=168
               SET ^ADVG(G,"AXE","P")=0
               SET ^("F")=0
               SET ^ADVG(G,OBJ,"P")=1
               SET L=0
               DO MOVE
               QUIT 
 +1        SET M=14
           QUIT 
AVM        SET J=$FIND("FEEFIEFOEFOOFUM",U1)\3
           SET M=42
           IF FOOBAR-1+J
               IF FOOBAR
                   SET M=151
               QUIT 
 +1        IF J-4
               SET FOOBAR=J
               SET M=54
               QUIT 
 +2        SET FOOBAR=0
           SET O="EGGS"
           SET L=^ADVG(G,O,"L")
           IF L=92!(LP=92&(TOTING["/EGGS/"))
               QUIT 
 +3        IF L=0
               IF ^ADVG(G,"TROLL","L")=0
                   IF ^("P")=0
                       SET ^("P")=1
 +4        DO HERE
           SET M=0
           SET L=92
           SET P=$SELECT(LP=92:0,$TEST:1,1:2)
           DO MOVE
           DO PSPK
           QUIT 
AVON       IF OBJ="BRIEF"
               GOTO AVONB
AVON1      IF OBJ'="LAMP"
               SET M=13
               QUIT 
AVONL      SET O="LAMP"
           DO HERE
          IF $TEST
               SET M=184
               IF LIMIT'<0
                   SET (LIT,^ADVG(G,O,"P"))=1
                   SET DARK=0
                   SET M=39

ADV6   3240     printed  Mar 25, 2016@15:27:03                                                                             Page 44

                   DO SPK
                   SET M=0
                   IF WZDARK
                       SET RET="SHOW^ADV2"
 +1        QUIT 
AVONB      SET ABB=10000
           SET DETAIL=3
           SET S=0
           SET M=156
           QUIT 
AVOF       IF OBJ="BRIEF"
               GOTO AVOFB
AVOF1      IF OBJ'="LAMP"
               SET M=13
               QUIT 
AVOFL      SET O="LAMP"
           DO HERE
          IF $TEST
               SET (LIT,^ADVG(G,O,"P"))=0
               SET M=40
               DO SPK
               SET DARK='$EXTRACT(CONDLP,3)
               SET M=$SELECT(DARK:16,1:0)
 +1        QUIT 
AVOFB      SET ABB=5
           SET DETAIL=0
           SET S=1
           SET M=54
           QUIT 
AVS        DO SC1^ADV8
           IF S
               WRITE !
           WRITE !,"If you were to quit now, you would score ",SCORE," out of a possible ",MXSCOR,"."
 +1        SET Q=143
           SET (Y,N)=54
           DO YES
           SET GAVEUP=$TEST
           SET M=0
           IF $TEST
               SET RET="SCORE^ADV8"
           QUIT 
AVV        SET J=0
           IF DARK
 +1       IF '$TEST
               IF CLOSED
                   IF TOTING["/OYSTE/"
                       SET OBJ="OYSTE"
                       SET J=1
 +2       IF '$TEST
               SET O="MAGAZ"
               DO AVVJ
 +3       IF '$TEST
               SET O="TABLE"
               DO AVVJ
 +4       IF '$TEST
               SET O="MESSA"
               DO AVVJ
 +5        IF J-1
               GOTO AV0^ADV5
AVV1       IF DARK
               SET RET="OBNONE^ADV3"

ADV6   3240     printed  Mar 25, 2016@15:27:03                                                                             Page 45

               QUIT 
 +1        SET J=OBJ="OYSTE"&(TOTING["/OYSTE/")
 +2        SET M=$SELECT(J&HINTED(2):194,OBJ="MESSA":191,OBJ="TABLE":196,OBJ="MAGAZ":190,1:M)
 +3        IF J
               IF 'HINTED(2)
                   SET Q=192
                   SET Y=193
                   SET N=54
                   DO YES
                   SET HINTED(2)=$TEST
                   SET M=0
 +4        QUIT 
AVVJ       DO HERE
          IF $TEST
               SET OBJ=O
               SET J=J+1
               IF J>1
 +1        QUIT 
AVZ        SET SAVED=1
           SET M=0
           DO PUTGAM^ADV
           QUIT 
YES        SET M=Q
           DO SPK
           DO KBD
           IF U?1"Y".1"ES"
               SET M=Y
               IF M
                   DO SPK
 +1       IF '$TEST
               IF U'?1"N".1"O"
                   WRITE "   Please answer the question."
                   GOTO YES
 +2       IF '$TEST
               SET M=N
               IF M
                   DO SPK
 +3        KILL M
           QUIT 
KBD        IF S
               WRITE !
           READ !,W:600
           IF '$TEST
               GOTO TIMO^ADV
           SET U=W
           FOR I=1:1
               IF U?.CNPU
                   QUIT 
               IF $EXTRACT(U,I)?1L
                   SET U=$EXTRACT(U,1,I-1)_$CHAR($ASCII(U,I)-32)_$EXTRACT(U,I+1,99)
 +1        KILL I
           QUIT 
SPK        IF S
               WRITE !
           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1        KILL I
           QUIT 
PSPK       SET N=^ADV(O,P,0)
           IF N
               IF S

ADV6   3240     printed  Mar 25, 2016@15:27:03                                                                             Page 46

                   WRITE !
               FOR I=.1:.1:N
                   WRITE !,^(I)
 +1        KILL I,N
           QUIT 
DROP       FOR Z=2:1:HOLDNG+1
               IF $PIECE(TOTING,"/",Z)=O
                   SET TOTING=$PIECE(TOTING,"/",1,Z-1)_"/"_$PIECE(TOTING,"/",Z+1,99)
                   SET HOLDNG=HOLDNG-1
                   QUIT 
 +1        SET ^ADVG(G,O,"L")=L
DR1        IF L>0
               SET ^("O")="/"_O_^ADVG(G,L,"O")
 +1        QUIT 
CARRY      IF TOTING[("/"_O_"/")
               QUIT 
           SET ^ADVG(G,O,"L")=-1
           SET HOLDNG=HOLDNG+1
           SET TOTING="/"_O_TOTING
CARRYF     SET Y=^ADVG(G,L,"O")
           FOR Z=2:1:$LENGTH(Y,"/")-1
               IF $PIECE(Y,"/",Z)=O
                   SET ^("O")=$PIECE(Y,"/",1,Z-1)_"/"_$PIECE(Y,"/",Z+1,99)
                   QUIT 
 +1        KILL Y,Z
           QUIT 
MOVE       SET MOL=L
           SET L=^ADVG(G,O,"L")
           IF L>0
               DO CARRY
           SET L=MOL
           DO DROP
           QUIT 
HERE       SET L=^ADVG(G,O,"L")
           IF L<0!(L=LP)
 +1        KILL L
           QUIT 
LIQ        SET O=^ADVG(G,"BOTTL","P")
           IF O<0
               SET O=-1-O
           SET O=$PIECE("WATER//OIL","/",O+1)
           QUIT 


ADV6     * *  65 Lines,  3240 Bytes, Checksum: B12934692                                              Mar 25, 2016@15:27:03 page 47
              37 bytes in comments
ADV6     ;ADVENTURE.  FLH ; 28 DEC 82  9:53 AM
AVB      I CLOSED,^ADVG(G,"ROD2","P")'<0 S O="ROD2" D HERE S @$S($T:"M=135,BONUS=25",LP=115:"M=134,BONUS=30",1:"M=133,BONUS=45"),RET
          ="SCORE^ADV8" D SPK
         Q
AVF      S I=$E(CONDLP,4) I OBJ="VASE" S M=$S('I:144,1:29) Q:TOTING'["/VASE/"!'I  S M=145 D SPK S M=0 G AVDV^ADV4
         I "BOTTL"[OBJ S O="BOTTL" D HERE G:OBJ=""&'$T AV0^ADV5 D LIQ S M=$S(O]"":105,'I:106,1:107) I M=107 S ^ADVG(G,"BOTTL","P")=$
          E("102",I+1),L=1 D LIQ,CARRY:TOTING["/BOTTL/" S:O="OIL" M=108
         Q
AVK      I OBJ="BIRD" S M=100 Q
         S J=$S(OBJ="TROLL":182,OBJ="DRAGO":102,1:0) I J=102,^ADVG(G,OBJ,"P") S J=110
         I J S M=J Q
         I OBJ="SNAKE" S M=102 Q:CLOSED  S O="BIRD" D HERE Q:'$T  S M=101,L=0,^ADVG(G,O,"P")=0,TALLY2=TALLY2+1 D MOVE Q
         I OBJ="DWARF" S O="FOOD" D HERE Q:'$T  S M=103 S:DFLAG<3 DFLAG=DFLAG+1 Q
AVK3     I OBJ="BEAR" S P=^ADVG(G,OBJ,"P"),M=$S(P=0:102,P=3:110,1:M),O="FOOD" D HERE Q:'$T  S M=168,^ADVG(G,"AXE","P")=0,^("F")=0,^A
          DVG(G,OBJ,"P")=1,L=0 D MOVE Q
         S M=14 Q
AVM      S J=$F("FEEFIEFOEFOOFUM",U1)\3,M=42 I FOOBAR-1+J S:FOOBAR M=151 Q
         I J-4 S FOOBAR=J,M=54 Q
         S FOOBAR=0,O="EGGS",L=^ADVG(G,O,"L") Q:L=92!(LP=92&(TOTING["/EGGS/"))
         I L=0,^ADVG(G,"TROLL","L")=0,^("P")=0 S ^("P")=1
         D HERE S M=0,L=92,P=$S(LP=92:0,$T:1,1:2) D MOVE,PSPK Q
AVON     G:OBJ="BRIEF" AVONB
AVON1    I OBJ'="LAMP" S M=13 Q
AVONL    S O="LAMP" D HERE I  S M=184 I LIMIT'<0 S (LIT,^ADVG(G,O,"P"))=1,DARK=0,M=39 D SPK S M=0 I WZDARK S RET="SHOW^ADV2"
         Q
AVONB    S ABB=10000,DETAIL=3,S=0,M=156 Q
AVOF     G:OBJ="BRIEF" AVOFB
AVOF1    I OBJ'="LAMP" S M=13 Q
AVOFL    S O="LAMP" D HERE I  S (LIT,^ADVG(G,O,"P"))=0,M=40 D SPK S DARK='$E(CONDLP,3),M=$S(DARK:16,1:0)
         Q
AVOFB    S ABB=5,DETAIL=0,S=1,M=54 Q
AVS      D SC1^ADV8 W:S ! W !,"If you were to quit now, you would score ",SCORE," out of a possible ",MXSCOR,"."
         S Q=143,(Y,N)=54 D YES S GAVEUP=$T,M=0 S:$T RET="SCORE^ADV8" Q
AVV      S J=0 I DARK
         E  I CLOSED,TOTING["/OYSTE/" S OBJ="OYSTE",J=1
         E  S O="MAGAZ" D AVVJ
         E  S O="TABLE" D AVVJ
         E  S O="MESSA" D AVVJ
         G:J-1 AV0^ADV5
AVV1     I DARK S RET="OBNONE^ADV3" Q
         S J=OBJ="OYSTE"&(TOTING["/OYSTE/")
         S M=$S(J&HINTED(2):194,OBJ="MESSA":191,OBJ="TABLE":196,OBJ="MAGAZ":190,1:M)
         I J,'HINTED(2) S Q=192,Y=193,N=54 D YES S HINTED(2)=$T,M=0
         Q
AVVJ     D HERE I  S OBJ=O,J=J+1 I J>1
         Q
AVZ      S SAVED=1,M=0 D PUTGAM^ADV Q
YES      S M=Q D SPK,KBD I U?1"Y".1"ES" S M=Y D:M SPK
         E  I U'?1"N".1"O" W "   Please answer the question." G YES
         E  S M=N D:M SPK
         K M Q
KBD      W:S ! R !,W:600 G:'$T TIMO^ADV S U=W F I=1:1 Q:U?.CNPU  I $E(U,I)?1L S U=$E(U,1,I-1)_$C($A(U,I)-32)_$E(U,I+1,99)
         K I Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
PSPK     S N=^ADV(O,P,0) I N W:S ! F I=.1:.1:N W !,^(I)
         K I,N Q
DROP     F Z=2:1:HOLDNG+1 I $P(TOTING,"/",Z)=O S TOTING=$P(TOTING,"/",1,Z-1)_"/"_$P(TOTING,"/",Z+1,99),HOLDNG=HOLDNG-1 Q


ADV6     * *  65 Lines,  3240 Bytes, Checksum: B12934692                                              Mar 25, 2016@15:27:03 page 48
         S ^ADVG(G,O,"L")=L
DR1      I L>0 S ^("O")="/"_O_^ADVG(G,L,"O")
         Q
CARRY    Q:TOTING[("/"_O_"/")  S ^ADVG(G,O,"L")=-1,HOLDNG=HOLDNG+1,TOTING="/"_O_TOTING
CARRYF   S Y=^ADVG(G,L,"O") F Z=2:1:$L(Y,"/")-1 I $P(Y,"/",Z)=O S ^("O")=$P(Y,"/",1,Z-1)_"/"_$P(Y,"/",Z+1,99) Q
         K Y,Z Q
MOVE     S MOL=L,L=^ADVG(G,O,"L") D:L>0 CARRY S L=MOL D DROP Q
HERE     S L=^ADVG(G,O,"L") I L<0!(L=LP)
         K L Q
LIQ      S O=^ADVG(G,"BOTTL","P") S:O<0 O=-1-O S O=$P("WATER//OIL","/",O+1) Q
*****   ERRORS & WARNINGS IN ADV6   *****
   ADV6+1       S - 2nd line of routine violates the SAC.

*****   INDEX OF ADV6   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> ABB          AVONB*,AVOFB*
>> CLOSED       AVB,AVK+3,AVV+1
>> CONDLP       AVF,AVOFL
>> DARK         AVONL*,AVOFL*,AVV,AVV1
>> DETAIL       AVONB*,AVOFB*
>> DFLAG        AVK+4*
>> FOOBAR       AVM,AVM+1*,AVM+2*
>> G            AVB,AVF+1,AVK+1,AVK+3,AVK3,AVM+2,AVM+3,AVONL,AVOFL,DROP+1,DR1,CARRY,CARRYF,MOVE,HERE,LIQ
>> GAVEUP       AVS+1*
>> HINTED(2     AVV1+2,AVV1+3*
>> HOLDNG       DROP*,CARRY*
   I            AVF*,AVF+1,KBD*,KBD+1!,SPK*,SPK+1!,PSPK*,PSPK+1!
>> J            AVK+1*,AVK+2,AVM*,AVM+1,AVV*,AVV+1*,AVV+5,AVV1+1*,AVV1+2,AVV1+3,AVVJ*
   L            AVF+1*,AVK+3*,AVK3*,AVM+2*,AVM+3,AVM+4*,DROP+1,DR1,CARRYF,MOVE*,HERE*,HERE+1!
>> LIMIT        AVONL
>> LIT          AVONL*,AVOFL*
>> LP           AVB,AVM+2,AVM+4,HERE
   M            AVF*,AVF+1*,AVK*,AVK+2*,AVK+3*,AVK+4*,AVK3*,AVK3+1*,AVM*,AVM+1*,AVM+4*,AVON1*,AVONL*,AVONB*,AVOF1*,AVOFL*,AVOFB*
                AVS+1*,AVV1+2*,AVV1+3*,AVZ*,YES*,YES+2*,YES+3!,SPK
>> MOL          MOVE*
>> MXSCOR       AVS
   N            AVS+1*,AVV1+3*,YES+2,PSPK*,PSPK+1!
>> O            AVB*,AVF+1*,AVK+3*,AVK+4*,AVK3*,AVM+2*,AVONL*,AVOFL*,AVV+2*,AVV+3*,AVV+4*,AVVJ,PSPK,DROP,DROP+1,DR1,CARRY,CARRYF
                MOVE,HERE,LIQ*
>> OBJ          AVF,AVF+1,AVK,AVK+1,AVK+3,AVK+4,AVK3,AVON,AVON1,AVOF,AVOF1,AVV+1*,AVV1+1,AVV1+2,AVVJ*
>> P            AVK3*,AVM+4*,PSPK
>> Q            AVS+1*,AVV1+3*,YES
>> RET          AVB*,AVONL*,AVS+1*,AVV1*
>> S            AVONB*,AVOFB*,AVS,KBD,SPK,PSPK
>> SAVED        AVZ*
>> SCORE        AVS
>> TALLY2       AVK+3*
>> TOTING       AVF,AVF+1,AVM+2,AVV+1,AVV1+1,DROP*,CARRY*
   U            YES,YES+1,KBD*
>> U1           AVM
>> W            KBD*
>> WZDARK       AVONL
   Y            AVS+1*,AVV1+3*,YES,CARRYF*,CARRYF+1!
   Z            DROP*,CARRYF*,CARRYF+1!

Global Variables  ( * Changed  ! Killed)


*****   INDEX OF ADV6   *****                                                                         Mar 25, 2016@15:27:03 page 49

Global Variables  ( * Changed  ! Killed)
   ^ADV(               PSPK
   ^ADV("t"            SPK
   ^ADVG(              AVB,AVF+1*,AVK+1,AVK+3*,AVK3*,AVM+2,AVM+3,AVONL*,AVOFL*,DROP+1*,DR1,CARRY*,CARRYF,MOVE,HERE,LIQ

Naked Globals
   ^(           SPK,PSPK
   ^("F"        AVK3*
   ^("O"        DR1*,CARRYF*
   ^("P"        AVM+3*

Marked Items
   NONE

Label References
   AVOFB        AVOF
   AVONB        AVON
   AVVJ         AVV+2,AVV+3,AVV+4
   CARRY        AVF+1,MOVE
   DROP         MOVE
   HERE         AVB,AVF+1,AVK+3,AVK+4,AVK3,AVM+4,AVONL,AVOFL,AVVJ
   KBD          YES
   LIQ          AVF+1
   MOVE         AVK+3,AVK3,AVM+4
   PSPK         AVM+4
   SPK          AVB,AVF,AVONL,AVOFL,YES,YES+2
   YES          AVS+1,AVV1+3,YES+1

External References
   PUTGAM^ADV          AVZ
   TIMO^ADV            KBD
   AVDV^ADV4           AVF
   AV0^ADV5            AVF+1,AVV+5
   SC1^ADV8            AVS

*****   END   *****

ADV7   2492     printed  Mar 25, 2016@15:27:03                                                                             Page 50

ADV7      ;ADVENTURE.  FLH ; 24 JAN 83  12:16 PM
AVH        SET M=209
           QUIT 
AVL        SET M=28
           FOR O="CLAM","OYSTE"
               DO HERE
              IF $TEST
                   SET OBJ=O
 +1        FOR O="DOOR","GRATE"
               DO AT
              IF $TEST
                   SET OBJ=O
 +2        SET O="CHAIN"
           DO HERE
          IF $TEST
               IF OBJ]""
                   GOTO AVT
               SET OBJ=O
 +3        IF OBJ=""
               QUIT 
AVL1       IF OBJ="CLAM"!(OBJ="OYSTE")
               GOTO AVL2
 +1        IF OBJ="DOOR"
               SET M=$SELECT(^ADVG(G,OBJ,"P")=1:54,1:111)
 +2       IF '$TEST
               SET M=$SELECT(OBJ="CAGE":32,OBJ="KEYS":55,OBJ="GRATE":31,OBJ="CHAIN":31,1:M)
 +3        SET O="KEYS"
           DO HERE
           IF M-31!'$TEST
               QUIT 
           IF OBJ="CHAIN"
               IF VERB="LOCK"
                   GOTO AVL4
               GOTO AVL3
 +4        IF CLOSNG
               IF 'PANIC
                   SET CLK2=15
               SET PANIC=1
               SET M=130
               QUIT 
 +5        SET M=^ADVG(G,"GRATE","P")+34
           SET (P,^("P"))=$SELECT(VERB="LOCK":0,1:1)
           SET M=2*P+M
           QUIT 
AVL2       SET J=OBJ="OYSTE"
           SET M=$SELECT(TOTING[("/"_OBJ_"/"):120,1:124)+J
 +1        IF TOTING'["/TRIDE/"
               SET M=122+J
           IF VERB="LOCK"
               SET M=61
 +2        IF M=124
               SET O="CLAM"
               SET L=0
               DO MOVE
               SET O="OYSTE"
               SET L=LP
               DO DROP
               SET O="PEARL"
               SET L=105
               DO DROP
 +3        QUIT 
AVL3 

ADV7   2492     printed  Mar 25, 2016@15:27:03                                                                             Page 51

           SET P=^ADVG(G,"BEAR","P")
           SET M=$SELECT(^ADVG(G,"CHAIN","P")=0:37,P=0:41,1:171)
 +1        IF M=171
               SET ^ADVG(G,"CHAIN","P")=0
               SET ^("F")=0
               IF P-3
                   SET (P,^ADVG(G,"BEAR","P"))=2
               SET ^ADVG(G,"BEAR","F")=2-P
 +2        QUIT 
AVL4       SET O="CHAIN"
           SET L=LP
           SET M=$SELECT(L-130:173,^ADVG(G,O,"P"):34,1:172)
 +1        IF M=172
               SET ^ADVG(G,O,"P")=2
               SET ^("F")=-1
               IF TOTING["/CHAIN/"
                   DO DROP
 +2        QUIT 
 +3       ;
AVT        IF $LENGTH(^ADVG(G,LP,"O"),"/")-3
               GOTO AV0^ADV5
           IF DFLAG>1
               FOR DW=1:1:5
                   IF LD(DW)=LP
                       GOTO AV0^ADV5
 +1        SET OBJ=$PIECE(^("O"),"/",2)
AVT1       IF TOTING[("/"_OBJ_"/")
               QUIT 
           SET M=25
           SET F=^ADVG(G,OBJ,"F")
           SET P=^("P")
 +1        IF OBJ="PLANT"
               IF P'>0
                   SET M=115
 +2       IF '$TEST
               IF OBJ="BEAR"
                   IF P=1
                       SET M=169
 +3       IF '$TEST
               IF OBJ="CHAIN"
                   IF ^ADVG(G,"BEAR","P")
                       SET M=170
 +4        IF F
               QUIT 
           IF OBJ'="WATER"
               IF OBJ'="OIL"
                   GOTO AVT2
 +5        DO LIQ
           SET I=O=OBJ
           SET (O,OBJ)="BOTTL"
           DO HERE
           IF $TEST&I
               GOTO AVT2
           SET I=TOTING["/BOTTL/"
           SET P=^ADVG(G,O,"P")
 +6        IF P=1&I
               GOTO AVF^ADV6
           SET M=$SELECT('I:104,P-1:105,1:M)
           QUIT 
AVT2       IF HOLDNG>7
               SET M=92

ADV7   2492     printed  Mar 25, 2016@15:27:03                                                                             Page 52

               QUIT 
 +1        SET L=LP
           IF OBJ'="BIRD"
               IF OBJ'="CAGE"
                   GOTO AVT3
 +2        SET P=^ADVG(G,"BIRD","P")
           IF OBJ="BIRD"
               IF P=0
                   SET M=26
                   IF TOTING["/ROD/"
                       QUIT 
                   SET M=27
                   IF TOTING'["/CAGE/"
                       QUIT 
                   SET (P,^ADVG(G,"BIRD","P"))=1
 +3        IF P
               SET O=$SELECT(OBJ="BIRD":"CAGE",1:"BIRD")
               DO CARRY
AVT3       SET O=OBJ
           DO CARRY
           DO LIQ
           IF O]""
               IF OBJ="BOTTL"
                   SET ^ADVG(G,O,"L")=-1
                   SET TOTING="/"_O_TOTING
                   SET HOLDNG=HOLDNG+1
 +1        SET M=54
           QUIT 
 +2       ;
DROP       FOR Z=2:1:HOLDNG+1
               IF $PIECE(TOTING,"/",Z)=O
                   SET TOTING=$PIECE(TOTING,"/",1,Z-1)_"/"_$PIECE(TOTING,"/",Z+1,99)
                   SET HOLDNG=HOLDNG-1
                   QUIT 
 +1        SET ^ADVG(G,O,"L")=L
DR1        IF L>0
               SET ^("O")="/"_O_^ADVG(G,L,"O")
 +1        QUIT 
CARRY      IF TOTING[("/"_O_"/")
               QUIT 
           SET ^ADVG(G,O,"L")=-1
           SET HOLDNG=HOLDNG+1
           SET TOTING="/"_O_TOTING
CARRYF     SET Y=^ADVG(G,L,"O")
           FOR Z=2:1:$LENGTH(Y,"/")-1
               IF $PIECE(Y,"/",Z)=O
                   SET ^("O")=$PIECE(Y,"/",1,Z-1)_"/"_$PIECE(Y,"/",Z+1,99)
                   QUIT 
 +1        KILL Y,Z
           QUIT 
MOVE       SET MOL=L
           SET L=^ADVG(G,O,"L")
           IF L>0
               DO CARRY
           SET L=MOL
           DO DROP
           QUIT 
HERE       SET L=^ADVG(G,O,"L")
           IF L<0!(L=LP)
 +1        KILL L
           QUIT 
AT 

ADV7   2492     printed  Mar 25, 2016@15:27:03                                                                             Page 53

           IF ^ADVG(G,O,"L")=LP!(^("F")=LP)
 +1        QUIT 
LIQ        SET O=^ADVG(G,"BOTTL","P")
           IF O<0
               SET O=-1-O
           SET O=$PIECE("WATER//OIL","/",O+1)
           QUIT 


ADV7     * *  52 Lines,  2492 Bytes, Checksum: B8631956                                               Mar 25, 2016@15:27:03 page 54
              40 bytes in comments
ADV7     ;ADVENTURE.  FLH ; 24 JAN 83  12:16 PM
AVH      S M=209 Q
AVL      S M=28 F O="CLAM","OYSTE" D HERE I  S OBJ=O
         F O="DOOR","GRATE" D AT I  S OBJ=O
         S O="CHAIN" D HERE I  G:OBJ]"" AVT S OBJ=O
         Q:OBJ=""
AVL1     I OBJ="CLAM"!(OBJ="OYSTE") G AVL2
         I OBJ="DOOR" S M=$S(^ADVG(G,OBJ,"P")=1:54,1:111)
         E  S M=$S(OBJ="CAGE":32,OBJ="KEYS":55,OBJ="GRATE":31,OBJ="CHAIN":31,1:M)
         S O="KEYS" D HERE Q:M-31!'$T  G:OBJ="CHAIN" AVL4:VERB="LOCK",AVL3
         I CLOSNG S:'PANIC CLK2=15 S PANIC=1,M=130 Q
         S M=^ADVG(G,"GRATE","P")+34,(P,^("P"))=$S(VERB="LOCK":0,1:1),M=2*P+M Q
AVL2     S J=OBJ="OYSTE",M=$S(TOTING[("/"_OBJ_"/"):120,1:124)+J
         S:TOTING'["/TRIDE/" M=122+J S:VERB="LOCK" M=61
         I M=124 S O="CLAM",L=0 D MOVE S O="OYSTE",L=LP D DROP S O="PEARL",L=105 D DROP
         Q
AVL3     S P=^ADVG(G,"BEAR","P"),M=$S(^ADVG(G,"CHAIN","P")=0:37,P=0:41,1:171)
         I M=171 S ^ADVG(G,"CHAIN","P")=0,^("F")=0 S:P-3 (P,^ADVG(G,"BEAR","P"))=2 S ^ADVG(G,"BEAR","F")=2-P
         Q
AVL4     S O="CHAIN",L=LP,M=$S(L-130:173,^ADVG(G,O,"P"):34,1:172)
         I M=172 S ^ADVG(G,O,"P")=2,^("F")=-1 D:TOTING["/CHAIN/" DROP
         Q
         ;
AVT      G:$L(^ADVG(G,LP,"O"),"/")-3 AV0^ADV5 I DFLAG>1 F DW=1:1:5 I LD(DW)=LP G AV0^ADV5
         S OBJ=$P(^("O"),"/",2)
AVT1     Q:TOTING[("/"_OBJ_"/")  S M=25,F=^ADVG(G,OBJ,"F"),P=^("P")
         I OBJ="PLANT",P'>0 S M=115
         E  I OBJ="BEAR",P=1 S M=169
         E  I OBJ="CHAIN",^ADVG(G,"BEAR","P") S M=170
         Q:F  I OBJ'="WATER",OBJ'="OIL" G AVT2
         D LIQ S I=O=OBJ,(O,OBJ)="BOTTL" D HERE G:$T&I AVT2 S I=TOTING["/BOTTL/",P=^ADVG(G,O,"P")
         G:P=1&I AVF^ADV6 S M=$S('I:104,P-1:105,1:M) Q
AVT2     I HOLDNG>7 S M=92 Q
         S L=LP I OBJ'="BIRD",OBJ'="CAGE" G AVT3
         S P=^ADVG(G,"BIRD","P") I OBJ="BIRD",P=0 S M=26 Q:TOTING["/ROD/"  S M=27 Q:TOTING'["/CAGE/"  S (P,^ADVG(G,"BIRD","P"))=1
         I P S O=$S(OBJ="BIRD":"CAGE",1:"BIRD") D CARRY
AVT3     S O=OBJ D CARRY,LIQ I O]"",OBJ="BOTTL" S ^ADVG(G,O,"L")=-1,TOTING="/"_O_TOTING,HOLDNG=HOLDNG+1
         S M=54 Q
         ;
DROP     F Z=2:1:HOLDNG+1 I $P(TOTING,"/",Z)=O S TOTING=$P(TOTING,"/",1,Z-1)_"/"_$P(TOTING,"/",Z+1,99),HOLDNG=HOLDNG-1 Q
         S ^ADVG(G,O,"L")=L
DR1      I L>0 S ^("O")="/"_O_^ADVG(G,L,"O")
         Q
CARRY    Q:TOTING[("/"_O_"/")  S ^ADVG(G,O,"L")=-1,HOLDNG=HOLDNG+1,TOTING="/"_O_TOTING
CARRYF   S Y=^ADVG(G,L,"O") F Z=2:1:$L(Y,"/")-1 I $P(Y,"/",Z)=O S ^("O")=$P(Y,"/",1,Z-1)_"/"_$P(Y,"/",Z+1,99) Q
         K Y,Z Q
MOVE     S MOL=L,L=^ADVG(G,O,"L") D:L>0 CARRY S L=MOL D DROP Q
HERE     S L=^ADVG(G,O,"L") I L<0!(L=LP)
         K L Q
AT       I ^ADVG(G,O,"L")=LP!(^("F")=LP)
         Q
LIQ      S O=^ADVG(G,"BOTTL","P") S:O<0 O=-1-O S O=$P("WATER//OIL","/",O+1) Q
*****   ERRORS & WARNINGS IN ADV7   *****
   ADV7+1       S - 2nd line of routine violates the SAC.

*****   INDEX OF ADV7   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)


*****   INDEX OF ADV7   *****                                                                         Mar 25, 2016@15:27:03 page 55

Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> CLK2         AVL1+4*
>> CLOSNG       AVL1+4
>> DFLAG        AVT
>> DW           AVT*
>> F            AVT1*,AVT1+4
>> G            AVL1+1,AVL1+5,AVL3,AVL3+1,AVL4,AVL4+1,AVT,AVT1,AVT1+3,AVT1+5,AVT2+2,AVT3,DROP+1,DR1,CARRY,CARRYF,MOVE,HERE,AT,LIQ
>> HOLDNG       AVT2,AVT3*,DROP*,CARRY*
>> I            AVT1+5*,AVT1+6
>> J            AVL2*,AVL2+1
   L            AVL2+2*,AVL4*,AVT2+1*,DROP+1,DR1,CARRYF,MOVE*,HERE*,HERE+1!
>> LD(          AVT
>> LP           AVL2+2,AVL4,AVT,AVT2+1,HERE,AT
>> M            AVH*,AVL*,AVL1+1*,AVL1+2*,AVL1+3,AVL1+4*,AVL1+5*,AVL2*,AVL2+1*,AVL2+2,AVL3*,AVL3+1,AVL4*,AVL4+1,AVT1*,AVT1+1*
                AVT1+2*,AVT1+3*,AVT1+6*,AVT2*,AVT2+2*,AVT3+1*
>> MOL          MOVE*
>> O            AVL*,AVL+1*,AVL+2*,AVL1+3*,AVL2+2*,AVL4*,AVL4+1,AVT1+5*,AVT2+3*,AVT3*,DROP,DROP+1,DR1,CARRY,CARRYF,MOVE,HERE,AT
                LIQ*
>> OBJ          AVL*,AVL+1*,AVL+2*,AVL+3,AVL1,AVL1+1,AVL1+2,AVL1+3,AVL2,AVT+1*,AVT1,AVT1+1,AVT1+2,AVT1+3,AVT1+4,AVT1+5*,AVT2+1
                AVT2+2,AVT2+3,AVT3
>> P            AVL1+5*,AVL3*,AVL3+1*,AVT1*,AVT1+1,AVT1+2,AVT1+5*,AVT1+6,AVT2+2*,AVT2+3
>> PANIC        AVL1+4*
>> TOTING       AVL2,AVL2+1,AVL4+1,AVT1,AVT1+5,AVT2+2,AVT3*,DROP*,CARRY*
>> VERB         AVL1+3,AVL1+5,AVL2+1
   Y            CARRYF*,CARRYF+1!
   Z            DROP*,CARRYF*,CARRYF+1!

Global Variables  ( * Changed  ! Killed)
   ^ADVG(              AVL1+1,AVL1+5,AVL3,AVL3+1*,AVL4,AVL4+1*,AVT,AVT1,AVT1+3,AVT1+5,AVT2+2*,AVT3*,DROP+1*,DR1,CARRY*,CARRYF,MOVE
                       HERE,AT,LIQ

Naked Globals
   ^("F"        AVL3+1*,AVL4+1*,AT
   ^("O"        AVT+1,DR1*,CARRYF*
   ^("P"        AVL1+5*,AVT1

Marked Items
   NONE

Label References
   AT           AVL+1
   AVL2         AVL1
   AVL3         AVL1+3
   AVL4         AVL1+3
   AVT          AVL+2
   AVT2         AVT1+4,AVT1+5
   AVT3         AVT2+1
   CARRY        AVT2+3,AVT3,MOVE
   DROP         AVL2+2,AVL4+1,MOVE
   HERE         AVL,AVL+2,AVL1+3,AVT1+5
   LIQ          AVT1+5,AVT3
   MOVE         AVL2+2

External References
   AV0^ADV5            AVT
   AVF^ADV6            AVT1+6

*****   END   *****

ADV8   2803     printed  Mar 25, 2016@15:27:03                                                                             Page 56

ADV8      ;ADVENTURE.  FLH ; 04 FEB 83  4:00 AM
CLOSEUP    FOR O="GRATE","FISSU"
               SET ^ADVG(G,O,"P")=0
 +1        FOR O="CHAIN","AXE"
               SET ^ADVG(G,O,"P")=0
               SET ^("F")=0
 +2        FOR DW=1:1:6
               SET (DSEEN(DW),LD(DW))=0
 +3        DO TROLLX^ADV4
           SET O="BEAR"
           SET L=0
           IF ^ADVG(G,O,"P")-3
               DO MOVE
 +4        SET CLK1=-1
           SET CLOSNG=1
           SET M=129
           DO SPK
           QUIT 
CLOSED     SET (L,LP,LP1,LNEW)=115
           SET P=-2
           SET O="BOTTL"
           DO CL1
 +1        SET P=-1
           FOR O="PLANT","OYSTE","LAMP","ROD","DWARF","MIRRO"
               DO CL1
 +2        SET L=116
           FOR O="CAGE","ROD2","PILLO"
               DO CL1
 +3        SET O="GRATE"
           DO MOVE
           SET P=-2
           FOR O="SNAKE","BIRD"
               DO CL1
 +4        SET ^ADVG(G,"MIRRO","F")=116
           SET CLOSED=1
           SET BONUS=10
           SET M=132
           DO SPK
 +5        FOR L=0:0
               SET O=$PIECE(TOTING,"/",2)
               IF O=""
                   QUIT 
               DO DROP
 +6        QUIT 
CL1        SET ^ADVG(G,O,"P")=P
           DO MOVE
           QUIT 
LAMP       SET O="LAMP"
           DO HERE
           SET I=$TEST
          IF $TEST
               SET O="BATTE"
               DO HERE
              IF $TEST
                   IF ^ADVG(G,O,"P")=0
 +1       IF $TEST
               SET ^("P")=1
               SET LIMIT=LIMIT+2500
               SET LMWARN=0
               SET L=LP
               SET M=188

ADV8   2803     printed  Mar 25, 2016@15:27:03                                                                             Page 57

               DO SPK
               IF TOTING["/BATTE/"
                   DO DROP
               QUIT 
 +2        IF LIMIT=0
               SET (LIT,^ADVG(G,"LAMP","P"))=0
               SET LIMIT=-1
               SET M=184
               IF I
                   DO SPK
               QUIT 
 +3        IF LIMIT<0
               IF LP<9
                   SET GAVEUP=1
                   SET M=185
                   DO SPK
                   QUIT 
 +4        IF I
               IF 'LMWARN
                   SET LMWARN=1
                   SET M=$SELECT(^ADVG(G,"BATTE","P")=1:189,^("L")=0:183,1:187)
                   DO SPK
 +5        QUIT 
DEAD       IF CLOSNG
               SET NUMDIE=NUMDIE+1
               SET M=131
               DO SPK
               GOTO SCORE
 +1        SET Q=NUMDIE*2+81
           SET Y=Q+1
           SET N=54
           SET NUMDIE=NUMDIE+1
           DO YES
           IF NUMDIE=3!'$TEST
               GOTO SCORE
 +2        FOR O="WATER","OIL"
               SET ^ADVG(G,O,"L")=0
 +3        IF TOTING["/LAMP/"
               SET O="LAMP"
               SET L=1
               SET (LIT,^ADVG(G,O,"P"))=0
               DO DROP
 +4        SET L=LP2
           FOR J=1:1:HOLDNG
               SET O=$PIECE(TOTING,"/",2)
               DO DROP
 +5        SET (LP,LP2,LNEW)=3
           GOTO NEWLP^ADV2
 +6       ;
SCORE      DO SC1
           IF S
               WRITE !
           WRITE !,"You scored ",SCORE," out of a possible ",MXSCOR,", using ",TURNS," turns."
 +1        SET I=$ORDER(^ADV("s",SCORE))
           WRITE !,^(I)
 +2        IF I<9999
               WRITE !,"To achieve the next higher rating, you need ",I-SCORE," points."
 +3        GOTO ENDGAM^ADV
SC1        SET (SCORE,MXSCOR)=2
 +1        FOR J=2:1:$LENGTH(TR,"/")-1
               SET N=$SELECT(J>7:16,J=7:14,1:12)

ADV8   2803     printed  Mar 25, 2016@15:27:03                                                                             Page 58

               SET MXSCOR=MXSCOR+N
               SET O=$PIECE(TR,"/",J)
               SET P=^ADVG(G,O,"P")
               SET SCORE=SCORE+$SELECT(^("L")=3&'P:N,P'<0:2,1:0)
 +2        FOR I=1:1:6
               SET Y=$TEXT(SC2+I)
               SET @$PIECE(Y,";",2)
               SET MXSCOR=MXSCOR+N
               XECUTE $PIECE(Y,";",3)
              IF $TEST
                   SET SCORE=SCORE+N
 +3        FOR I=2:1:9
               IF HINTED(I)
                   SET SCORE=SCORE-$PIECE(^ADV("h",I),"/",2)
SC2        QUIT 
 +1       ;N=30;S N=30-(NUMDIE*10) I 1;
 +2       ;N=4;I VERB'="SCORE",'GAVEUP;
 +3       ;N=25;I DFLAG;
 +4       ;N=25;I CLOSNG;
 +5       ;N=BONUS;I 1;
 +6       ;N=1;I ^ADVG(G,"MAGAZ","L")=108;
YES        SET M=Q
           DO SPK
           DO KBD
           IF U?1"Y".1"ES"
               SET M=Y
               IF M
                   DO SPK
 +1       IF '$TEST
               IF U'?1"N".1"O"
                   WRITE "   Please answer the question."
                   GOTO YES
 +2       IF '$TEST
               SET M=N
               IF M
                   DO SPK
 +3        KILL M
           QUIT 
KBD        IF S
               WRITE !
           READ !,W:600
           IF '$TEST
               GOTO TIMO^ADV
           SET U=W
           FOR I=1:1
               IF U?.CNPU
                   QUIT 
               IF $EXTRACT(U,I)?1L
                   SET U=$EXTRACT(U,1,I-1)_$CHAR($ASCII(U,I)-32)_$EXTRACT(U,I+1,99)
 +1        KILL I
           QUIT 
SPK        IF S
               WRITE !
           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1        KILL I
           QUIT 
DROP       FOR Z=2:1:HOLDNG+1
               IF $PIECE(TOTING,"/",Z)=O
                   SET TOTING=$PIECE(TOTING,"/",1,Z-1)_"/"_$PIECE(TOTING,"/",Z+1,99)
                   SET HOLDNG=HOLDNG-1

ADV8   2803     printed  Mar 25, 2016@15:27:03                                                                             Page 59

                   QUIT 
 +1        SET ^ADVG(G,O,"L")=L
DR1        IF L>0
               SET ^("O")="/"_O_^ADVG(G,L,"O")
 +1        QUIT 
CARRY      IF TOTING[("/"_O_"/")
               QUIT 
           SET ^ADVG(G,O,"L")=-1
           SET HOLDNG=HOLDNG+1
           SET TOTING="/"_O_TOTING
CARRYF     SET Y=^ADVG(G,L,"O")
           FOR Z=2:1:$LENGTH(Y,"/")-1
               IF $PIECE(Y,"/",Z)=O
                   SET ^("O")=$PIECE(Y,"/",1,Z-1)_"/"_$PIECE(Y,"/",Z+1,99)
                   QUIT 
 +1        KILL Y,Z
           QUIT 
MOVE       SET MOL=L
           SET L=^ADVG(G,O,"L")
           IF L>0
               DO CARRY
           SET L=MOL
           DO DROP
           QUIT 
HERE       SET L=^ADVG(G,O,"L")
           IF L<0!(L=LP)
 +1        KILL L
           QUIT 


ADV8     * *  60 Lines,  2803 Bytes, Checksum: B9881802                                               Mar 25, 2016@15:27:03 page 60
              170 bytes in comments
ADV8     ;ADVENTURE.  FLH ; 04 FEB 83  4:00 AM
CLOSEUP  F O="GRATE","FISSU" S ^ADVG(G,O,"P")=0
         F O="CHAIN","AXE" S ^ADVG(G,O,"P")=0,^("F")=0
         F DW=1:1:6 S (DSEEN(DW),LD(DW))=0
         D TROLLX^ADV4 S O="BEAR",L=0 I ^ADVG(G,O,"P")-3 D MOVE
         S CLK1=-1,CLOSNG=1,M=129 D SPK Q
CLOSED   S (L,LP,LP1,LNEW)=115,P=-2,O="BOTTL" D CL1
         S P=-1 F O="PLANT","OYSTE","LAMP","ROD","DWARF","MIRRO" D CL1
         S L=116 F O="CAGE","ROD2","PILLO" D CL1
         S O="GRATE" D MOVE S P=-2 F O="SNAKE","BIRD" D CL1
         S ^ADVG(G,"MIRRO","F")=116,CLOSED=1,BONUS=10,M=132 D SPK
         F L=0:0 S O=$P(TOTING,"/",2) Q:O=""  D DROP
         Q
CL1      S ^ADVG(G,O,"P")=P D MOVE Q
LAMP     S O="LAMP" D HERE S I=$T I  S O="BATTE" D HERE I  I ^ADVG(G,O,"P")=0
         I  S ^("P")=1,LIMIT=LIMIT+2500,LMWARN=0,L=LP,M=188 D SPK,DROP:TOTING["/BATTE/" Q
         I LIMIT=0 S (LIT,^ADVG(G,"LAMP","P"))=0,LIMIT=-1,M=184 D:I SPK Q
         I LIMIT<0,LP<9 S GAVEUP=1,M=185 D SPK Q
         I I,'LMWARN S LMWARN=1,M=$S(^ADVG(G,"BATTE","P")=1:189,^("L")=0:183,1:187) D SPK
         Q
DEAD     I CLOSNG S NUMDIE=NUMDIE+1,M=131 D SPK G SCORE
         S Q=NUMDIE*2+81,Y=Q+1,N=54,NUMDIE=NUMDIE+1 D YES I NUMDIE=3!'$T G SCORE
         F O="WATER","OIL" S ^ADVG(G,O,"L")=0
         I TOTING["/LAMP/" S O="LAMP",L=1,(LIT,^ADVG(G,O,"P"))=0 D DROP
         S L=LP2 F J=1:1:HOLDNG S O=$P(TOTING,"/",2) D DROP
         S (LP,LP2,LNEW)=3 G NEWLP^ADV2
         ;
SCORE    D SC1 W:S ! W !,"You scored ",SCORE," out of a possible ",MXSCOR,", using ",TURNS," turns."
         S I=$O(^ADV("s",SCORE)) W !,^(I)
         I I<9999 W !,"To achieve the next higher rating, you need ",I-SCORE," points."
         G ENDGAM^ADV
SC1      S (SCORE,MXSCOR)=2
         F J=2:1:$L(TR,"/")-1 S N=$S(J>7:16,J=7:14,1:12),MXSCOR=MXSCOR+N,O=$P(TR,"/",J),P=^ADVG(G,O,"P"),SCORE=SCORE+$S(^("L")=3&'P:
          N,P'<0:2,1:0)
         F I=1:1:6 S Y=$T(SC2+I),@$P(Y,";",2),MXSCOR=MXSCOR+N X $P(Y,";",3) I  S SCORE=SCORE+N
         F I=2:1:9 I HINTED(I) S SCORE=SCORE-$P(^ADV("h",I),"/",2)
SC2      Q
         ;N=30;S N=30-(NUMDIE*10) I 1;
         ;N=4;I VERB'="SCORE",'GAVEUP;
         ;N=25;I DFLAG;
         ;N=25;I CLOSNG;
         ;N=BONUS;I 1;
         ;N=1;I ^ADVG(G,"MAGAZ","L")=108;
YES      S M=Q D SPK,KBD I U?1"Y".1"ES" S M=Y D:M SPK
         E  I U'?1"N".1"O" W "   Please answer the question." G YES
         E  S M=N D:M SPK
         K M Q
KBD      W:S ! R !,W:600 G:'$T TIMO^ADV S U=W F I=1:1 Q:U?.CNPU  I $E(U,I)?1L S U=$E(U,1,I-1)_$C($A(U,I)-32)_$E(U,I+1,99)
         K I Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
DROP     F Z=2:1:HOLDNG+1 I $P(TOTING,"/",Z)=O S TOTING=$P(TOTING,"/",1,Z-1)_"/"_$P(TOTING,"/",Z+1,99),HOLDNG=HOLDNG-1 Q
         S ^ADVG(G,O,"L")=L
DR1      I L>0 S ^("O")="/"_O_^ADVG(G,L,"O")
         Q
CARRY    Q:TOTING[("/"_O_"/")  S ^ADVG(G,O,"L")=-1,HOLDNG=HOLDNG+1,TOTING="/"_O_TOTING
CARRYF   S Y=^ADVG(G,L,"O") F Z=2:1:$L(Y,"/")-1 I $P(Y,"/",Z)=O S ^("O")=$P(Y,"/",1,Z-1)_"/"_$P(Y,"/",Z+1,99) Q
         K Y,Z Q


ADV8     * *  60 Lines,  2803 Bytes, Checksum: B9881802                                               Mar 25, 2016@15:27:03 page 61
MOVE     S MOL=L,L=^ADVG(G,O,"L") D:L>0 CARRY S L=MOL D DROP Q
HERE     S L=^ADVG(G,O,"L") I L<0!(L=LP)
         K L Q
*****   ERRORS & WARNINGS IN ADV8   *****
   ADV8+1       S - 2nd line of routine violates the SAC.

*****   INDEX OF ADV8   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> BONUS        CLOSED+4*
>> CLK1         CLOSEUP+4*
>> CLOSED       CLOSED+4*
>> CLOSNG       CLOSEUP+4*,DEAD
>> DSEEN(       CLOSEUP+2*
>> DW           CLOSEUP+2*
>> G            CLOSEUP,CLOSEUP+1,CLOSEUP+3,CLOSED+4,CL1,LAMP,LAMP+2,LAMP+4,DEAD+2,DEAD+3,SC1+1,DROP+1,DR1,CARRY,CARRYF,MOVE,HERE
>> GAVEUP       LAMP+3*
>> HINTED(      SC1+3
>> HOLDNG       DEAD+4,DROP*,CARRY*
   I            LAMP*,LAMP+2,LAMP+4,SCORE+1*,SCORE+2,SC1+2*,SC1+3*,KBD*,KBD+1!,SPK*,SPK+1!
>> J            DEAD+4*,SC1+1*
   L            CLOSEUP+3*,CLOSED*,CLOSED+2*,CLOSED+5*,LAMP+1*,DEAD+3*,DEAD+4*,DROP+1,DR1,CARRYF,MOVE*,HERE*,HERE+1!
>> LD(          CLOSEUP+2*
>> LIMIT        LAMP+1*,LAMP+2*,LAMP+3
>> LIT          LAMP+2*,DEAD+3*
>> LMWARN       LAMP+1*,LAMP+4*
>> LNEW         CLOSED*,DEAD+5*
>> LP           CLOSED*,LAMP+1,LAMP+3,DEAD+5*,HERE
>> LP1          CLOSED*
>> LP2          DEAD+4,DEAD+5*
   M            CLOSEUP+4*,CLOSED+4*,LAMP+1*,LAMP+2*,LAMP+3*,LAMP+4*,DEAD*,YES*,YES+2*,YES+3!,SPK
>> MOL          MOVE*
>> MXSCOR       SCORE,SC1*,SC1+1*,SC1+2*
>> N            DEAD+1*,SC1+1*,SC1+2,YES+2
>> NUMDIE       DEAD*,DEAD+1*
>> O            CLOSEUP*,CLOSEUP+1*,CLOSEUP+3*,CLOSED*,CLOSED+1*,CLOSED+2*,CLOSED+3*,CLOSED+5*,CL1,LAMP*,DEAD+2*,DEAD+3*,DEAD+4*
                SC1+1*,DROP,DROP+1,DR1,CARRY,CARRYF,MOVE,HERE
>> P            CLOSED*,CLOSED+1*,CLOSED+3*,CL1,SC1+1*
>> Q            DEAD+1*,YES
>> S            SCORE,KBD,SPK
>> SCORE        SCORE,SCORE+1,SCORE+2,SC1*,SC1+1*,SC1+2*,SC1+3*
>> TOTING       CLOSED+5,LAMP+1,DEAD+3,DEAD+4,DROP*,CARRY*
>> TR           SC1+1
>> TURNS        SCORE
   U            YES,YES+1,KBD*
>> W            KBD*
   Y            DEAD+1*,SC1+2*,YES,CARRYF*,CARRYF+1!
   Z            DROP*,CARRYF*,CARRYF+1!

Global Variables  ( * Changed  ! Killed)
   ^ADV("h"            SC1+3
   ^ADV("s"            SCORE+1
   ^ADV("t"            SPK
   ^ADVG(              CLOSEUP*,CLOSEUP+1*,CLOSEUP+3,CLOSED+4*,CL1*,LAMP,LAMP+2*,LAMP+4,DEAD+2*,DEAD+3*,SC1+1,DROP+1*,DR1,CARRY*
                       CARRYF,MOVE,HERE

Naked Globals


*****   INDEX OF ADV8   *****                                                                         Mar 25, 2016@15:27:03 page 62

Naked Globals
   ^(           SCORE+1,SPK
   ^("F"        CLOSEUP+1*
   ^("L"        LAMP+4,SC1+1
   ^("O"        DR1*,CARRYF*
   ^("P"        LAMP+1*

Marked Items
   $T(SC2+I     SC1+2

Label References
   CARRY        MOVE
   CL1          CLOSED,CLOSED+1,CLOSED+2,CLOSED+3
   DROP         CLOSED+5,LAMP+1,DEAD+3,DEAD+4,MOVE
   HERE         LAMP
   KBD          YES
   MOVE         CLOSEUP+3,CLOSED+3,CL1
   SC1          SCORE
   SCORE        DEAD,DEAD+1
   SPK          CLOSEUP+4,CLOSED+4,LAMP+1,LAMP+2,LAMP+3,LAMP+4,DEAD,YES,YES+2
   YES          DEAD+1,YES+1

External References
   ENDGAM^ADV          SCORE+3
   TIMO^ADV            KBD
   NEWLP^ADV2          DEAD+5
   TROLLX^ADV4         CLOSEUP+3

*****   END   *****

ADV9   2807     printed  Mar 25, 2016@15:27:03                                                                             Page 63

ADV9      ;ADVENTURE.  FLH ; 29 DEC 82  8:52 AM
HINT       DO @("HINT"_J)
          IF '$TEST
               IF J=5
                   QUIT 
               GOTO HI1
 +1        SET X=^ADV("h",J)
           SET P=$PIECE(X,"/",2)
           SET Q=$PIECE(X,"/",3)
           SET Y=0
           SET N=54
           DO YES
          IF '$TEST
               QUIT 
 +2        IF S
               WRITE !
           WRITE !,"I am prepared to give you a hint, but it will cost you ",P," points."
 +3        SET Q=175
           SET Y=$PIECE(X,"/",4)
           DO YES
           SET HINTED(J)=$TEST
          IF $TEST
               IF LIMIT>30
                   SET LIMIT=30*P+LIMIT
HI1        SET HINTLC(J)=0
           QUIT 
HINT4      IF ^ADVG(G,"GRATE","P")=0
               SET O="KEYS"
               DO HERE
               IF '$TEST
 +1        QUIT 
HINT5      IF OBJ="BIRD"
               SET O=OBJ
               DO HERE
              IF $TEST
                   IF TOTING["/ROD/"
 +1        QUIT 
HINT6      SET O="BIRD"
           DO HERE
           IF '$TEST
               SET O="SNAKE"
               DO HERE
 +1        QUIT 
HINT7      SET I=HOLDNG>1
           FOR L=LP,LP1,LP2
               IF 'I
                   QUIT 
               IF L>0
                   SET I=^ADVG(G,L,"O")="/"
 +1        IF I
 +2        KILL I
           QUIT 
HINT8      IF ^ADVG(G,"EMERA","P")=-1
               IF ^ADVG(G,"PLATI","P")=-1
 +1        QUIT 
HINT9      IF 1
 +1        QUIT 
TRS1       IF "/EMERA/"'[TOTING
               SET M=117
               DO SPK
 +1       IF '$TEST

ADV9   2807     printed  Mar 25, 2016@15:27:03                                                                             Page 64

               SET LNEW=199-LP
 +2        QUIT 
TRS2       SET O="EMERA"
           SET L=LP
           SET RET="TR1"
           DO DROP
           QUIT 
TRS3       SET O="TROLL"
           IF ^ADVG(G,O,"P")=1
               SET ^("P")=0
               SET P=1
               DO PSPK
               SET L=117
               DO MOVE
               SET L=122
               DO MOVEF
               SET O="TROLL2"
               SET L=0
               DO MOVE
               DO MOVEF
               SET O="CHASM"
               DO JUGGLE
               QUIT 
 +1        SET LNEW=239-LP
           IF ^("P")=0
               SET ^("P")=1
           IF TOTING'["/BEAR/"
               QUIT 
 +2        SET ^ADVG(G,"CHASM","P")=1
           SET ^ADVG(G,"TROLL","P")=2
           SET O="BEAR"
           SET L=LNEW
           SET M=162
           DO DROP
           DO SPK
           SET ^ADVG(G,O,"F")=-1
           SET ^("P")=3
 +3        IF ^ADVG(G,"SPICE","P")<0
               SET TALLY2=TALLY2+1
           SET LP2=LNEW
           SET RET="DEAD^ADV8"
           QUIT 
TRB        SET L3=$SELECT($EXTRACT(^ADV(LP1,"c")):LP2,1:LP1)
           SET LP2=LP1
           SET LP1=LP
           IF L3=LP
               SET M=91
               DO SPK
 +1       IF '$TEST
               SET MOV="A"
               FOR Z=0:0
                   SET MOV=$ORDER(^ADV(LP,MOV))
                   IF MOV]"ZZ"
                       QUIT 
                   FOR J=1:1:^(MOV,0)
                       SET Y=^(J)
                       IF $PIECE(Y,"\",2)="TR2"
                           SET L=$PIECE(Y,"\",3)
                           SET LL(L)=""
                           IF L=L3
                               SET LNEW=L3

ADV9   2807     printed  Mar 25, 2016@15:27:03                                                                             Page 65

                               GOTO TRB1
 +2       IF '$TEST
               SET L=""
               FOR Z=0:0
                   SET L=$ORDER(LL(L))
                   IF L=""
                       QUIT 
                   IF $DATA(^ADV(L,"FORCED",1))
                       IF $PIECE(^(1),"\",3)=L3
                           SET LNEW=L3
                           QUIT 
 +3       IF '$TEST
               SET M=140
               DO SPK
TRB1       KILL L3,LL,MOV
           QUIT 
TRC        SET M=$SELECT(LP<8:57,1:58)
           DO SPK
           QUIT 
TRL        IF DETAIL<3
               SET M=15
               DO SPK
 +1        SET DETAIL=DETAIL+1
           SET WZDARK=0
           SET ^ADVG(G,LP,"A")=0
           QUIT 
TRN        QUIT 
YES        SET M=Q
           DO SPK
           DO KBD
           IF U?1"Y".1"ES"
               SET M=Y
               IF M
                   DO SPK
 +1       IF '$TEST
               IF U'?1"N".1"O"
                   WRITE "   Please answer the question."
                   GOTO YES
 +2       IF '$TEST
               SET M=N
               IF M
                   DO SPK
 +3        KILL M
           QUIT 
KBD        IF S
               WRITE !
           READ !,W:600
           IF '$TEST
               GOTO TIMO^ADV
           SET U=W
           FOR I=1:1
               IF U?.CNPU
                   QUIT 
               IF $EXTRACT(U,I)?1L
                   SET U=$EXTRACT(U,1,I-1)_$CHAR($ASCII(U,I)-32)_$EXTRACT(U,I+1,99)
 +1        KILL I
           QUIT 
SPK        IF S
               WRITE !
           FOR I=1:1:^ADV("t",M,0)
               WRITE !,^(I)
 +1 

ADV9   2807     printed  Mar 25, 2016@15:27:03                                                                             Page 66

           KILL I
           QUIT 
PSPK       SET N=^ADV(O,P,0)
           IF N
               IF S
                   WRITE !
               FOR I=.1:.1:N
                   WRITE !,^(I)
 +1        KILL I,N
           QUIT 
DROPF      SET ^ADVG(G,O,"F")=L
           GOTO DR1
DROP       FOR Z=2:1:HOLDNG+1
               IF $PIECE(TOTING,"/",Z)=O
                   SET TOTING=$PIECE(TOTING,"/",1,Z-1)_"/"_$PIECE(TOTING,"/",Z+1,99)
                   SET HOLDNG=HOLDNG-1
                   QUIT 
 +1        SET ^ADVG(G,O,"L")=L
DR1        IF L>0
               SET ^("O")="/"_O_^ADVG(G,L,"O")
 +1        QUIT 
CARRY      IF TOTING[("/"_O_"/")
               QUIT 
           SET ^ADVG(G,O,"L")=-1
           SET HOLDNG=HOLDNG+1
           SET TOTING="/"_O_TOTING
CARRYF     SET Y=^ADVG(G,L,"O")
           FOR Z=2:1:$LENGTH(Y,"/")-1
               IF $PIECE(Y,"/",Z)=O
                   SET ^("O")=$PIECE(Y,"/",1,Z-1)_"/"_$PIECE(Y,"/",Z+1,99)
                   QUIT 
 +1        KILL Y,Z
           QUIT 
MOVEF      SET MOL=L
           SET L=^ADVG(G,O,"F")
           IF L>0
               DO CARRYF
           SET L=MOL
           DO DROPF
           QUIT 
MOVE       SET MOL=L
           SET L=^ADVG(G,O,"L")
           IF L>0
               DO CARRY
           SET L=MOL
           DO DROP
           QUIT 
HERE       SET L=^ADVG(G,O,"L")
           IF L<0!(L=LP)
 +1        KILL L
           QUIT 
JUGGLE     SET L=^ADVG(G,O,"L")
           IF L>0
               SET X=^ADVG(G,L,"O")
               SET K=$FIND(X,"/"_O_"/")
               IF K
                   SET ^("O")="/"_O_$EXTRACT(X,1,K-$LENGTH(O)-2)_$EXTRACT(X,K,255)
 +1        KILL K,L,X
           QUIT 
LIQ        SET O=^ADVG(G,"BOTTL","P")
           IF O<0

ADV9   2807     printed  Mar 25, 2016@15:27:03                                                                             Page 67

               SET O=-1-O
           SET O=$PIECE("WATER//OIL","/",O+1)
           QUIT 


ADV9     * *  61 Lines,  2807 Bytes, Checksum: B11397199                                              Mar 25, 2016@15:27:03 page 68
              37 bytes in comments
ADV9     ;ADVENTURE.  FLH ; 29 DEC 82  8:52 AM
HINT     D @("HINT"_J) E  Q:J=5  G HI1
         S X=^ADV("h",J),P=$P(X,"/",2),Q=$P(X,"/",3),Y=0,N=54 D YES E  Q
         W:S ! W !,"I am prepared to give you a hint, but it will cost you ",P," points."
         S Q=175,Y=$P(X,"/",4) D YES S HINTED(J)=$T I  I LIMIT>30 S LIMIT=30*P+LIMIT
HI1      S HINTLC(J)=0 Q
HINT4    I ^ADVG(G,"GRATE","P")=0 S O="KEYS" D HERE I '$T
         Q
HINT5    I OBJ="BIRD" S O=OBJ D HERE I  I TOTING["/ROD/"
         Q
HINT6    S O="BIRD" D HERE I '$T S O="SNAKE" D HERE
         Q
HINT7    S I=HOLDNG>1 F L=LP,LP1,LP2 Q:'I  I L>0 S I=^ADVG(G,L,"O")="/"
         I I
         K I Q
HINT8    I ^ADVG(G,"EMERA","P")=-1,^ADVG(G,"PLATI","P")=-1
         Q
HINT9    I 1
         Q
TRS1     I "/EMERA/"'[TOTING S M=117 D SPK
         E  S LNEW=199-LP
         Q
TRS2     S O="EMERA",L=LP,RET="TR1" D DROP Q
TRS3     S O="TROLL" I ^ADVG(G,O,"P")=1 S ^("P")=0,P=1 D PSPK S L=117 D MOVE S L=122 D MOVEF S O="TROLL2",L=0 D MOVE,MOVEF S O="CHAS
          M" D JUGGLE Q
         S LNEW=239-LP S:^("P")=0 ^("P")=1 Q:TOTING'["/BEAR/"
         S ^ADVG(G,"CHASM","P")=1,^ADVG(G,"TROLL","P")=2,O="BEAR",L=LNEW,M=162 D DROP,SPK S ^ADVG(G,O,"F")=-1,^("P")=3
         S:^ADVG(G,"SPICE","P")<0 TALLY2=TALLY2+1 S LP2=LNEW,RET="DEAD^ADV8" Q
TRB      S L3=$S($E(^ADV(LP1,"c")):LP2,1:LP1),LP2=LP1,LP1=LP I L3=LP S M=91 D SPK
         E  S MOV="A" F Z=0:0 S MOV=$O(^ADV(LP,MOV)) Q:MOV]"ZZ"  F J=1:1:^(MOV,0) S Y=^(J) I $P(Y,"\",2)="TR2" S L=$P(Y,"\",3),LL(L)
          ="" I L=L3 S LNEW=L3 G TRB1
         E  S L="" F Z=0:0 S L=$O(LL(L)) Q:L=""  I $D(^ADV(L,"FORCED",1)),$P(^(1),"\",3)=L3 S LNEW=L3 Q
         E  S M=140 D SPK
TRB1     K L3,LL,MOV Q
TRC      S M=$S(LP<8:57,1:58) D SPK Q
TRL      I DETAIL<3 S M=15 D SPK
         S DETAIL=DETAIL+1,WZDARK=0,^ADVG(G,LP,"A")=0 Q
TRN      Q
YES      S M=Q D SPK,KBD I U?1"Y".1"ES" S M=Y D:M SPK
         E  I U'?1"N".1"O" W "   Please answer the question." G YES
         E  S M=N D:M SPK
         K M Q
KBD      W:S ! R !,W:600 G:'$T TIMO^ADV S U=W F I=1:1 Q:U?.CNPU  I $E(U,I)?1L S U=$E(U,1,I-1)_$C($A(U,I)-32)_$E(U,I+1,99)
         K I Q
SPK      W:S ! F I=1:1:^ADV("t",M,0) W !,^(I)
         K I Q
PSPK     S N=^ADV(O,P,0) I N W:S ! F I=.1:.1:N W !,^(I)
         K I,N Q
DROPF    S ^ADVG(G,O,"F")=L G DR1
DROP     F Z=2:1:HOLDNG+1 I $P(TOTING,"/",Z)=O S TOTING=$P(TOTING,"/",1,Z-1)_"/"_$P(TOTING,"/",Z+1,99),HOLDNG=HOLDNG-1 Q
         S ^ADVG(G,O,"L")=L
DR1      I L>0 S ^("O")="/"_O_^ADVG(G,L,"O")
         Q
CARRY    Q:TOTING[("/"_O_"/")  S ^ADVG(G,O,"L")=-1,HOLDNG=HOLDNG+1,TOTING="/"_O_TOTING
CARRYF   S Y=^ADVG(G,L,"O") F Z=2:1:$L(Y,"/")-1 I $P(Y,"/",Z)=O S ^("O")=$P(Y,"/",1,Z-1)_"/"_$P(Y,"/",Z+1,99) Q
         K Y,Z Q
MOVEF    S MOL=L,L=^ADVG(G,O,"F") D:L>0 CARRYF S L=MOL D DROPF Q
MOVE     S MOL=L,L=^ADVG(G,O,"L") D:L>0 CARRY S L=MOL D DROP Q


ADV9     * *  61 Lines,  2807 Bytes, Checksum: B11397199                                              Mar 25, 2016@15:27:03 page 69
HERE     S L=^ADVG(G,O,"L") I L<0!(L=LP)
         K L Q
JUGGLE   S L=^ADVG(G,O,"L") I L>0 S X=^ADVG(G,L,"O"),K=$F(X,"/"_O_"/") I K S ^("O")="/"_O_$E(X,1,K-$L(O)-2)_$E(X,K,255)
         K K,L,X Q
LIQ      S O=^ADVG(G,"BOTTL","P") S:O<0 O=-1-O S O=$P("WATER//OIL","/",O+1) Q
*****   ERRORS & WARNINGS IN ADV9   *****
   ADV9+1       S - 2nd line of routine violates the SAC.

*****   INDEX OF ADV9   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
>> DETAIL       TRL,TRL+1*
>> G            HINT4,HINT7,HINT8,TRS3,TRS3+2,TRS3+3,TRL+1,DROPF,DROP+1,DR1,CARRY,CARRYF,MOVEF,MOVE,HERE,JUGGLE,LIQ
>> HINTED(      HINT+3*
>> HINTLC(      HI1*
>> HOLDNG       HINT7,DROP*,CARRY*
   I            HINT7*,HINT7+1,HINT7+2!,KBD*,KBD+1!,SPK*,SPK+1!,PSPK*,PSPK+1!
>> J            HINT,HINT+1,HINT+3,HI1,TRB+1*
   K            JUGGLE*,JUGGLE+1!
   L            HINT7*,TRS2*,TRS3*,TRS3+2*,TRB+1*,TRB+2*,DROPF,DROP+1,DR1,CARRYF,MOVEF*,MOVE*,HERE*,HERE+1!,JUGGLE*,JUGGLE+1!
   L3           TRB*,TRB+1,TRB+2,TRB1!
>> LIMIT        HINT+3*
   LL           TRB1!
   LL(          TRB+1*,TRB+2
>> LNEW         TRS1+1*,TRS3+1*,TRS3+2,TRS3+3,TRB+1*,TRB+2*
>> LP           HINT7,TRS1+1,TRS2,TRS3+1,TRB,TRB+1,TRC,TRL+1,HERE
>> LP1          HINT7,TRB*
>> LP2          HINT7,TRS3+3*,TRB*
   M            TRS1*,TRS3+2*,TRB*,TRB+3*,TRC*,TRL*,YES*,YES+2*,YES+3!,SPK
>> MOL          MOVEF*,MOVE*
   MOV          TRB+1*,TRB1!
   N            HINT+1*,YES+2,PSPK*,PSPK+1!
>> O            HINT4*,HINT5*,HINT6*,TRS2*,TRS3*,TRS3+2*,PSPK,DROPF,DROP,DROP+1,DR1,CARRY,CARRYF,MOVEF,MOVE,HERE,JUGGLE,LIQ*
>> OBJ          HINT5
>> P            HINT+1*,HINT+2,HINT+3,TRS3*,PSPK
>> Q            HINT+1*,HINT+3*,YES
>> RET          TRS2*,TRS3+3*
>> S            HINT+2,KBD,SPK,PSPK
>> TALLY2       TRS3+3*
>> TOTING       HINT5,TRS1,TRS3+1,DROP*,CARRY*
   U            YES,YES+1,KBD*
>> W            KBD*
>> WZDARK       TRL+1*
   X            HINT+1*,HINT+3,JUGGLE*,JUGGLE+1!
   Y            HINT+1*,HINT+3*,TRB+1*,YES,CARRYF*,CARRYF+1!
   Z            TRB+1*,TRB+2*,DROP*,CARRYF*,CARRYF+1!

Global Variables  ( * Changed  ! Killed)
   ^ADV(               TRB,TRB+1,TRB+2,PSPK
   ^ADV("h"            HINT+1
   ^ADV("t"            SPK
   ^ADVG(              HINT4,HINT7,HINT8,TRS3,TRS3+2*,TRS3+3,TRL+1*,DROPF*,DROP+1*,DR1,CARRY*,CARRYF,MOVEF,MOVE,HERE,JUGGLE,LIQ

Naked Globals
   ^(           TRB+1,SPK,PSPK
   ^("O"        DR1*,CARRYF*,JUGGLE*
   ^("P"        TRS3*,TRS3+1*,TRS3+2*


*****   INDEX OF ADV9   *****                                                                         Mar 25, 2016@15:27:03 page 70

Naked Globals
   ^(1          TRB+2

Marked Items
   NONE

Label References
   @(           HINT
   CARRY        MOVE
   CARRYF       MOVEF
   DR1          DROPF
   DROP         TRS2,TRS3+2,MOVE
   DROPF        MOVEF
   HERE         HINT4,HINT5,HINT6
   HI1          HINT
   JUGGLE       TRS3
   KBD          YES
   MOVE         TRS3
   MOVEF        TRS3
   PSPK         TRS3
   SPK          TRS1,TRS3+2,TRB,TRB+3,TRC,TRL,YES,YES+2
   TRB1         TRB+1
   YES          HINT+1,HINT+3,YES+1

External References
   TIMO^ADV            KBD

*****   END   *****

ADVDOC   3162     printed  Mar 25, 2016@15:27:03                                                                           Page 71

ADVDOC    ;ADVENTURE.  FLH ; 25 JAN 83  10:32 AM
I         ; Adventure is the original computer game that has inspired dozens of
 +1       ; descendants of the "Dungeons and Dragons" genre.  First coded in
 +2       ; Fortran for the PDP-10 by Willie Crowther at MIT, it was revised and
 +3       ; extended by Don Woods of the Stanford Artificial Intelligence lab.
 +4       ; Kent Blackett and Bob Supnick of Digital Equipment Corp. rewrote
 +5       ; it in Fortran IV-Plus and then in Fortran IV for the PDP-11.
 +6       ; Fred Hiltz of InterSystems Corp. translated it into ANSI Standard
 +7       ; MUMPS--this program.
 +8       ;
II        ; Any number can play simultaneously:  "D ^ADV" to get started.  Each
 +1       ; player gives a name to his/her game, which can be suspended with a
 +2       ; SUSPEND command at any time and later resumed.  Saved games more than
 +3       ; ten days old are deleted automatically.
 +4       ;
III       ; This program is written to run in InterSystems Corporation's M/11
 +1       ; implementation of 1983 ANSI Standard MUMPS.  There are ten routines:
 +2       ; AD, ADDOC, and AD2-AD9.  They require 40K bytes of disk storage.
 +3       ; One global, ^ADV, contains the geography, text, etc.--it requires
 +4       ; 84K bytes.  The second global, ^ADVG, holds the variables associated
 +5       ; with each game in progress or suspended.  It requires 6K bytes per
 +6       ; game.  Adventure should run in a partition of at least 6K bytes.
 +7       ;
IV        ; Adventure is supplied on a magnetic tape containing a file of
 +1       ; routines followed by a file of the global ^ADV.  Both files are
 +2       ; written with 1024-byte physical records in the DOS format.  To
 +3       ; install the game in M/11, mount the tape, sign in to the UCI in
 +4       ; which the game will run, and D ^%RI.  Give tape parameters:
 +5       ;     ("D3":0:1024)  if the tape is marked 800 bpi, or
 +6       ;     ("D4":0:1024)  if the tape is marked 1600 bpi.
 +7       ; Tell %RI to load all the routines.  The tape does not contain
 +8       ; comments for ^COMMENT.  When %RI has finished, leave the tape in
 +9       ; position and D ^%GI.  Give the same tape parameters.
 +10      ;
V         ; After ^ADV is in place, you may optionally D ^%PROTECT and follow
 +1       ; its instructions to allow read-only access to ^ADV from all UCI's,
 +2       ; thus protecting it from change or deletion.  This completes the
 +3       ; installation of Adventure.
 +4       ;
VI        ; Adventure may easily be ported to other systems that support 1983
 +1       ; ANSI Standard MUMPS.  The only non-standard features are confined
 +2       ; to the routine AD:  $ZS is the size of the partition in kilobytes.
 +3       ; $ZE governs trapping of errors and keyboard breaks.  Its code may be
 +4       ; removed without detriment to the game.  The utility routine %ET is
 +5       ; used to log the local variables following an error.
 +6       ;
VII       ; For maintenance of Adventure please write, not telephone,
 +1       ;          Frederick L. Hiltz, Ph. D.
 +2       ;          Systems Development Engineer
 +3       ;          InterSystems Corporation
 +4       ;          210 Commercial Street, Third Floor
 +5       ;          Boston, MA  02109
 +6       ;
 +7       ; Maintenance will be provided only for the unaltered program, and only
 +8       ; when a printout of the error logged by %ET is included (use the %ER
 +9       ; utility).  On a time-available basis, I will return either a patch
 +10      ; or a new release of the program.


ADVDOC   * *  57 Lines,  3162 Bytes, Checksum: B32832                                                 Mar 25, 2016@15:27:03 page 72
              2971 bytes in comments
ADVDOC   ;ADVENTURE.  FLH ; 25 JAN 83  10:32 AM
I        ; Adventure is the original computer game that has inspired dozens of
         ; descendants of the "Dungeons and Dragons" genre.  First coded in
         ; Fortran for the PDP-10 by Willie Crowther at MIT, it was revised and
         ; extended by Don Woods of the Stanford Artificial Intelligence lab.
         ; Kent Blackett and Bob Supnick of Digital Equipment Corp. rewrote
         ; it in Fortran IV-Plus and then in Fortran IV for the PDP-11.
         ; Fred Hiltz of InterSystems Corp. translated it into ANSI Standard
         ; MUMPS--this program.
         ;
II       ; Any number can play simultaneously:  "D ^ADV" to get started.  Each
         ; player gives a name to his/her game, which can be suspended with a
         ; SUSPEND command at any time and later resumed.  Saved games more than
         ; ten days old are deleted automatically.
         ;
III      ; This program is written to run in InterSystems Corporation's M/11
         ; implementation of 1983 ANSI Standard MUMPS.  There are ten routines:
         ; AD, ADDOC, and AD2-AD9.  They require 40K bytes of disk storage.
         ; One global, ^ADV, contains the geography, text, etc.--it requires
         ; 84K bytes.  The second global, ^ADVG, holds the variables associated
         ; with each game in progress or suspended.  It requires 6K bytes per
         ; game.  Adventure should run in a partition of at least 6K bytes.
         ;
IV       ; Adventure is supplied on a magnetic tape containing a file of
         ; routines followed by a file of the global ^ADV.  Both files are
         ; written with 1024-byte physical records in the DOS format.  To
         ; install the game in M/11, mount the tape, sign in to the UCI in
         ; which the game will run, and D ^%RI.  Give tape parameters:
         ;     ("D3":0:1024)  if the tape is marked 800 bpi, or
         ;     ("D4":0:1024)  if the tape is marked 1600 bpi.
         ; Tell %RI to load all the routines.  The tape does not contain
         ; comments for ^COMMENT.  When %RI has finished, leave the tape in
         ; position and D ^%GI.  Give the same tape parameters.
         ;
V        ; After ^ADV is in place, you may optionally D ^%PROTECT and follow
         ; its instructions to allow read-only access to ^ADV from all UCI's,
         ; thus protecting it from change or deletion.  This completes the
         ; installation of Adventure.
         ;
VI       ; Adventure may easily be ported to other systems that support 1983
         ; ANSI Standard MUMPS.  The only non-standard features are confined
         ; to the routine AD:  $ZS is the size of the partition in kilobytes.
         ; $ZE governs trapping of errors and keyboard breaks.  Its code may be
         ; removed without detriment to the game.  The utility routine %ET is
         ; used to log the local variables following an error.
         ;
VII      ; For maintenance of Adventure please write, not telephone,
         ;          Frederick L. Hiltz, Ph. D.
         ;          Systems Development Engineer
         ;          InterSystems Corporation
         ;          210 Commercial Street, Third Floor
         ;          Boston, MA  02109
         ;
         ; Maintenance will be provided only for the unaltered program, and only
         ; when a printout of the error logged by %ET is included (use the %ER
         ; utility).  On a time-available basis, I will return either a patch
         ; or a new release of the program.
*****   ERRORS & WARNINGS IN ADVDOC   *****


ADVDOC   * *  57 Lines,  3162 Bytes, Checksum: B32832                                                 Mar 25, 2016@15:27:03 page 73

*****   ERRORS & WARNINGS IN ADVDOC   *****
   ADVDOC+1     S - 2nd line of routine violates the SAC.

*****   INDEX OF ADVDOC   *****


Local Variables      Line Occurrences   ( >> not killed explicitly)
                                        ( * Changed  ! Killed  ~ Newed)
   NONE

Global Variables  ( * Changed  ! Killed)
   NONE

Naked Globals
   NONE

Marked Items
   NONE

Label References
   NONE

External References
   NONE

*****   END   *****


*****   Cross Reference of all Routines   *****                                                       Mar 25, 2016@15:27:03 page 74

Local Variables    Routines   ( >> not killed explicitly)
                              ( * Changed  ! Killed  ~ Newed)
>> ABB          ADV2,ADV6*
>> ATTACK       ADV2*
>> BONUS        ADV8*
>> CLK1         ADV3*,ADV8*
>> CLK2         ADV2*,ADV3*,ADV7*
>> CLOSED       ADV2,ADV3,ADV4,ADV5,ADV6,ADV8*
>> CLOSNG       ADV2,ADV4,ADV7,ADV8*
>> CONDLP       ADV2*,ADV3,ADV5,ADV6
   D            ADV*!
>> DARK         ADV2*,ADV3,ADV6*
>> DETAIL       ADV6*,ADV9*
>> DFLAG        ADV2*,ADV3,ADV5,ADV6*,ADV7
>> DKILL        ADV4*
>> DSEEN(       ADV2*,ADV4*,ADV8*
>> DSEEN(6      ADV2*
>> DW           ADV2*,ADV3*,ADV4*,ADV5*,ADV7*,ADV8*
   F            ADV!,ADV2*,ADV7*
   F(           ADV*
>> FOOBAR       ADV3*,ADV6*
>> G            ADV*,ADV2,ADV3,ADV4,ADV5,ADV6,ADV7,ADV8,ADV9
>> GAME         ADV*
>> GAVEUP       ADV*,ADV3,ADV5*,ADV6*,ADV8*
>> HINTED(      ADV3,ADV8,ADV9*
>> HINTED(2     ADV6*
>> HINTED(3     ADV*
>> HINTH(       ADV3
>> HINTLC(      ADV3*,ADV9*
>> HOLDNG       ADV2*,ADV3,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*
   I            ADV*!,ADV2*!,ADV3*!,ADV4*!,ADV5*!,ADV6*!,ADV7*,ADV8*!,ADV9*!
   IN           ADV!
   IN(          ADV*
>> J            ADV2*,ADV3*,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*
   K            ADV2*,ADV4*!,ADV9*!
>> KNFL         ADV2*,ADV3*
   L            ADV*,ADV2*!,ADV3*!,ADV4*!,ADV5*!,ADV6*!,ADV7*!,ADV8*!,ADV9*!
   L3           ADV9*!
>> LD(          ADV2*,ADV3,ADV4*,ADV5,ADV7,ADV8*
>> LD(6         ADV2*
>> LD1(         ADV2*
>> LD1(6        ADV2*
>> LIMIT        ADV*,ADV2*,ADV3*,ADV6,ADV8*,ADV9*
>> LIT          ADV2,ADV3,ADV6*,ADV8*
   LL           ADV2!,ADV9!
   LL(          ADV2*,ADV9*
>> LMWARN       ADV8*
>> LNEW         ADV2*,ADV3*,ADV4*,ADV5*,ADV8*,ADV9*
>> LP           ADV2*,ADV3,ADV4,ADV5*,ADV6,ADV7,ADV8*,ADV9
>> LP1          ADV3*,ADV8*,ADV9*
>> LP2          ADV2*,ADV3*,ADV8*,ADV9*
   M            ADV*!,ADV2*,ADV3*,ADV4*,ADV5*!,ADV6*!,ADV7*,ADV8*!,ADV9*!
>> MOL          ADV2*,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*
   MOV          ADV3*,ADV9*!
>> MOX          ADV3*
>> MXSCOR       ADV6,ADV8*
   N            ADV*!,ADV2*!,ADV3*!,ADV4*!,ADV5*!,ADV6*!,ADV8*,ADV9*!
>> NAME         ADV*


*****   Cross Reference of all Routines   *****                                                       Mar 25, 2016@15:27:03 page 75

Local Variables    Routines   ( >> not killed explicitly)
                              ( * Changed  ! Killed  ~ Newed)
>> ND           ADV2*
>> NUMDIE       ADV8*
>> O            ADV2*,ADV3*,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*
>> OBJ          ADV3*,ADV4*,ADV5*,ADV6*,ADV7*,ADV9
   OUT          ADV!
   OUT(         ADV*
>> P            ADV2*,ADV3*,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*
>> PANIC        ADV2*,ADV7*
>> Q            ADV*,ADV5*,ADV6*,ADV8*,ADV9*
>> RET          ADV*,ADV3*,ADV4*,ADV5*,ADV6*,ADV9*
>> S            ADV*,ADV2,ADV3,ADV4,ADV5,ADV6*,ADV8,ADV9
>> SAVED        ADV,ADV6*
>> SCORE        ADV6,ADV8*
>> STICK        ADV2*
   T            ADV!
   T(           ADV*
>> TALLY        ADV2*,ADV3
>> TALLY2       ADV2,ADV4*,ADV5*,ADV6*,ADV9*
>> TOTING       ADV2*,ADV3,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*
>> TR           ADV2,ADV4,ADV8
>> TURNS        ADV3*,ADV8
   U            ADV*!,ADV3*!,ADV5*!,ADV6*,ADV8*,ADV9*
   U(           ADV*
>> U1           ADV*,ADV3*,ADV4*,ADV5*,ADV6
>> U2           ADV*,ADV3*,ADV4,ADV5*
>> VBX          ADV3*
>> VERB         ADV3*,ADV5*,ADV7
>> W            ADV*,ADV3*,ADV5*,ADV6*,ADV8*,ADV9*
>> W1           ADV*,ADV3*,ADV4*,ADV5*
>> W2           ADV*,ADV3*,ADV4,ADV5*
>> WD1          ADV2*,ADV3*,ADV4*,ADV5
>> WD1X         ADV2*,ADV3*,ADV4*
>> WD2          ADV3*,ADV4*
>> WD2X         ADV3*,ADV4
>> WZDARK       ADV2,ADV3*,ADV6,ADV9*
   X            ADV*!,ADV2*,ADV4*!,ADV5*,ADV9*!
>> XID          ADV
>> XID("USER"   ADV
   Y            ADV*,ADV2*!,ADV3*,ADV4*!,ADV5*!,ADV6*!,ADV7*!,ADV8*!,ADV9*!
   Z            ADV*,ADV2*!,ADV4*!,ADV5*!,ADV6*!,ADV7*!,ADV8*!,ADV9*!

Global Variables
   ^ADV(               ADV2,ADV3,ADV4,ADV5,ADV6,ADV9
   ^ADV("ON"           ADV3
   ^ADV("QUIT"         ADV
   ^ADV("h"            ADV8,ADV9
   ^ADV("s"            ADV8
   ^ADV("t"            ADV,ADV2,ADV3,ADV4,ADV5,ADV6,ADV8,ADV9
   ^ADVG(              ADV*!,ADV2*,ADV3,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*

Naked Globals
   ^(           ADV*!,ADV2,ADV3,ADV4,ADV5,ADV6,ADV8,ADV9
   ^("A"        ADV2*
   ^("F"        ADV2,ADV3,ADV4*,ADV5,ADV6*,ADV7*,ADV8*
   ^("L"        ADV8
   ^("O"        ADV*,ADV2*,ADV4*,ADV5*,ADV6*,ADV7*,ADV8*,ADV9*


*****   Cross Reference of all Routines   *****                                                       Mar 25, 2016@15:27:03 page 76

Naked Globals
   ^("P"        ADV2*,ADV3*,ADV4*,ADV6*,ADV7*,ADV8*,ADV9*
   ^(0          ADV3
   ^(1          ADV9

Marked Items
   $T(SC2+I     ADV8

Routine             Invokes:
   ADV          %ET,TIMO^ADV,ADV2
   ADV2         TRAVEL^ADV3,TURN^ADV3,DEAD^ADV8
   ADV3         TIMO^ADV,NEWLP^ADV2,CLOSED^ADV8,CLOSEUP^ADV8,LAMP^ADV8,SCORE^ADV8,HINT^ADV9
   ADV4         AVD^ADV4,AVA^ADV5,AVK3^ADV6
   ADV5         TIMO^ADV,RUCKUS^ADV4
   ADV6         PUTGAM^ADV,TIMO^ADV,AVDV^ADV4,AV0^ADV5,SC1^ADV8
   ADV7         AV0^ADV5,AVF^ADV6
   ADV8         ENDGAM^ADV,TIMO^ADV,NEWLP^ADV2,TROLLX^ADV4
   ADV9         TIMO^ADV

Routine             is Invoked by:
   ^%ET                ADV
   ENDGAM^ADV          ADV8
   PUTGAM^ADV          ADV6
   TIMO^ADV            ADV,ADV3,ADV5,ADV6,ADV8,ADV9
   ^ADV2               ADV
   NEWLP^ADV2          ADV3,ADV8
   TRAVEL^ADV3         ADV2
   TURN^ADV3           ADV2
   AVD^ADV4            ADV4
   AVDV^ADV4           ADV6
   RUCKUS^ADV4         ADV5
   TROLLX^ADV4         ADV8
   AV0^ADV5            ADV6,ADV7
   AVA^ADV5            ADV4
   AVF^ADV6            ADV7
   AVK3^ADV6           ADV4
   CLOSED^ADV8         ADV3
   CLOSEUP^ADV8        ADV3
   DEAD^ADV8           ADV2
   LAMP^ADV8           ADV3
   SC1^ADV8            ADV6
   SCORE^ADV8          ADV3
   HINT^ADV9           ADV3

*****   END   *****


--- END ---
